select PAYMENT_METHOD, TOTAL_COUNT from (
SELECT
RPD.PAYMENT_METHOD,
--row_number() over (partition by RPD.PAYMENT_METHOD order by RPD.Policy_Issue_Date desc) as rnum,
count(*) over () as TOTAL_COUNT
FROM
(
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.Policy_Issue_Date,
RPOL.PMTHOD AS PAYMENT_METHOD
FROM
(
SELECT
POL.PNO,
POL.Policy_Issue_Date,
CASE 
    WHEN TRIM(POL.PMTHOD) = 'C' THEN 'CC'
    WHEN TRIM(POL.PMTHOD) = 'A' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) = 'M' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) IN ('Q','S','A') THEN 'CASH_CHEQUE'
END PMTHOD
FROM
(
 
SELECT
LFPPML.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PDOI)),1,TO_DATE(TO_CHAR(LFPPML.PDOI),'YYYY-MM-DD'),TO_DATE('19000101','YYYY_MM_DD')) AS Policy_Issue_Date,
LFPPML.PMODE,
LFPPML.PMTHOD
FROM 
MR_LFPPML LFPPML
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPML.LPLAN = TBP.PLAN
WHERE
LFPPML.PNO = '%policyNumber%'  /*POLICY NUMBER*/
 
)POL 
/*LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO */ /* HL-376, retrieveAccountDetails Performance Fix */ 
)RPOL 
 
 
UNION ALL
 
 
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.Policy_Issue_Date,
RPOL.PMTHOD AS PAYMENT_METHOD
 
FROM
(
SELECT
POL.PNO,
POL.Policy_Issue_Date,
CASE 
    WHEN TRIM(POL.PMTHOD) = 'C' THEN 'CC'
    WHEN TRIM(POL.PMTHOD) = 'A' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) = 'M' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) IN ('Q','S','A') THEN 'CASH_CHEQUE'
END PMTHOD
FROM
(
 
SELECT
LFPPMG.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PDOI)),1,TO_DATE(TO_CHAR(LFPPMG.PDOI),'YYYY-MM-DD'),TO_DATE('19000101','YYYY_MM_DD')) AS Policy_Issue_Date,
LFPPMG.PMODE,
LFPPMG.PMTHOD
FROM 
MR_LFPPMG LFPPMG
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPMG.GPLAN = TBP.PLAN
WHERE
LFPPMG.PNO = '%policyNumber%' /*POLICY NUMBER*/
)POL 
/*LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO */ /* HL-376, retrieveAccountDetails Performance Fix */ 
)RPOL 
 
 
UNION ALL
 
 
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.Policy_Issue_Date,
RPOL.PMTHOD AS PAYMENT_METHOD
FROM
(
SELECT
POL.PNO,
POL.Policy_Issue_Date,
CASE 
    WHEN TRIM(POL.PMTHOD) = 'C' THEN 'CC'
    WHEN TRIM(POL.PMTHOD) = 'A' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) = 'M' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) IN ('Q','S','A') THEN 'CASH_CHEQUE'
END PMTHOD
FROM
(
 
SELECT
LFPPMD.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PDOI)),1,TO_DATE(TO_CHAR(LFPPMD.PDOI),'YYYY-MM-DD'),TO_DATE('19000101','YYYY_MM_DD')) AS Policy_Issue_Date,
LFPPMD.PMODE,
LFPPMD.PMTHOD
FROM 
MR_LFPPMD LFPPMD
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPMD.DPLAN = TBP.PLAN
WHERE
LFPPMD.PNO = '%policyNumber%'  /*POLICY NUMBER*/
)POL 
/*LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO */ /* HL-376, retrieveAccountDetails Performance Fix */ 
)RPOL 
 
 
UNION ALL
 
 
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.Policy_Issue_Date,
RPOL.PMTHOD AS PAYMENT_METHOD
FROM
(
 
SELECT
POL.PNO,
POL.Policy_Issue_Date,
CASE 
    WHEN TRIM(POL.PMTHOD) = 'C' THEN 'CC'
    WHEN TRIM(POL.PMTHOD) = 'A' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) = 'M' THEN 'DA'
    WHEN TRIM(POL.PMTHOD) IS NULL AND TRIM(POL.PMODE) IN ('Q','S','A') THEN 'CASH_CHEQUE'
END PMTHOD
FROM
(
SELECT
LFPPMH.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PDOI)),1,TO_DATE(TO_CHAR(LFPPMH.PDOI),'YYYYMMDD'),TO_DATE('19000101','YYYY_MM_DD'))  AS Policy_Issue_Date,
LFPPMH.PMODE,
LFPPMH.PMTHOD
FROM
MR_LFPPMH LFPPMH
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPMH.HPLAN = TBP.PLAN
WHERE LFPPMH.PNO = '%policyNumber%'    /* INPUT POLICY NUMBER */ 
)POL
/*LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO  */      /* HL-376, retrieveAccountDetails Performance Fix */ 
)RPOL
)RPD
) x
where rownum = 1
