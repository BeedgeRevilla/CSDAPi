SELECT
POL_DETAILS.POLICY_NUMBER,
POL_DETAILS.POLICY_EFFECTIVE_DATE,
POL_DETAILS.POLICY_ISSUE_DATE,
POL_DETAILS.POLICY_TERMINATION_DATE,
POL_DETAILS.SUBMISSION_DATE,
POL_DETAILS.CURRENCY,
POL_DETAILS.POLICY_STATUS,
POL_DETAILS.DIVIDEND_OPTION,
POL_DETAILS.ACCUMULATED_DIVIDEND,
POL_DETAILS.ACCUMULATED_DIV_INTRST,
POL_DETAILS.ADDITIONAL_PAID_UP_AMOUNT,
POL_DETAILS.FACE_VAL_ON_RVRSNRY_BONUS,
POL_DETAILS.FACE_VAL_ON_TRMNL_BONUS,
POL_DETAILS.BONUS_IN_FACE_VALUE_AMOUNT,
POL_DETAILS.ADDITIONAL_PAID_UP_FACE_VALUE,
POL_DETAILS.COUPON_AMOUNT,
POL_DETAILS.DATE_OF_COST_INS_UPD,
POL_DETAILS.LOAN_BALANCE,
POL_DETAILS.LOAN_BLNCE_INTEREST,
POL_DETAILS.DEATH_BNFT_OPTIONS,
POL_DETAILS.INDEXATION_STATE,
POL_DETAILS.POLICY_INDEXATION_TYPE,
POL_DETAILS.COMMUNICATION_MEANS,
POL_DETAILS.SMS,
POL_DETAILS.SUS_SMS,
POL_DETAILS.SUS_EMAIL,
POL_DETAILS.ESERVICE_INDICATOR,
POL_DETAILS.MAE_OPTION_CODE,
POL_DETAILS.COUPON_INTEREST,
POL_DETAILS.REDUCED_PAID_UP,
POL_DETAILS.PURE_ENDOWMENT,
POL_DETAILS.ETA_EXPIRY_DATE,
POL_DETAILS.ASSIGNEE_TYPE_CODE,
POL_DETAILS.PLAN_CODE,
POL_DETAILS.EXPIRY_DATE,
POL_DETAILS.INITIAL_LS_PREMIUM,
POL_DETAILS.REGULAR_TOPUP_PREMIUM,
POL_DETAILS.FUTURE_PREMIUM_DEPOSIT,
POL_DETAILS.MODAL_PREMIUM,
POL_DETAILS.FUTURE_PREM_DEPOSIT_INTEREST,
POL_DETAILS.PREMIUM_DUE_DATE,
POL_DETAILS.PREMIUM_HOLIDAY_START,
POL_DETAILS.PREMIUM_HOLIDAY_END,
POL_DETAILS.PAYMENT_MODE_CD,
POL_DETAILS.PAYMENT_METHOD,
POL_DETAILS.OWNER_LAST_NAME,
POL_DETAILS.OWNER_PARTY_TYP_CD,
POL_DETAILS.OWNER_PARTY_ID,
POL_DETAILS.OWNER_ID_DOC_NUMBER, 
POL_DETAILS.ID_DOCUMENT_TYPE,
POL_DETAILS.INSRD_LAST_NAME,
POL_DETAILS.DATE_OF_BIRTH,
POL_DETAILS.GENDER,
POL_DETAILS.INSRD_PARTY_TYP_CD,
POL_DETAILS.INSRD_PARTY_ID, 
POL_DETAILS.INS_ID_DOCUMENT_NUMBER,
POL_DETAILS.ASSIGNEE_NAME,
POL_DETAILS.ASSIGNEE_TYPE,
POL_DETAILS.PRODUCING_AGENT_CD_1,
POL_DETAILS.PRODUCING_AGENT_CD_2,
POL_DETAILS.SERVICING_AGENT_CD_1,
POL_DETAILS.SERVICING_AGENT_CD_2,
POL_DETAILS.SUM_INSURED,
POL_DETAILS.TOTAL_SUM_INSURED,
POL_DETAILS.BASIC_SUM_INSURED,
POL_DETAILS.POLICY_TYPE,
POL_DETAILS.TOTAL_AMOUNT,
--POL_DETAILS.WITHDRAWAL_AMOUNT,
POL_DETAILS.PREMIUM_OVERDUE,
POL_DETAILS.PREMIUM_HOLIDAY_INDICATOR,
POL_DETAILS.REINSTATEMENT_EFF_DATE,
POL_DETAILS.EFF_POLICY_CHANGE_DATE,
POL_DETAILS.TRANS_DATE,
POL_DETAILS.ACTUAL_TERM_DATE,
POL_DETAILS.MODAL_COMMISSION,
POL_DETAILS.COMMISSION_RATE,
POL_DETAILS.PAID_TO_DATE,
POL_DETAILS.CLASS_CODE,
POL_DETAILS.CSC_CODE,
POL_DETAILS.POLICY_ADDRESS_LINE_1,
POL_DETAILS.POLICY_ADDRESS_LINE_2,
POL_DETAILS.POLICY_ADDRESS_LINE_3,
POL_DETAILS.POLICY_ADDRESS_LINE_4,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_1,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_2,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_3,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_4,
POL_DETAILS.ACTIVITY_SUSPENSION_FLG	,		/* DATH-686 */
POL_DETAILS.EXCLUSION, /*DAHK-573*/
POL_DETAILS.TEMP_LOADING, /*DAHK-573*/
POL_DETAILS.ACTUAL_SERVICING_AGENT /*DAHK-1853*/,
POL_DETAILS.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_1,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_CITY,                  /*  DAPH-1192  */
POL_DETAILS.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
POL_DETAILS.MAINTENANCE_CD,                 /*  DAPH-1192  */
POL_DETAILS.SOURCE_CD,                       /*  DAPH-1192  */
POL_DETAILS.LILSP,		/*NBPT*/
POL_DETAILS.LBPRM,		/*NBPT*/
POL_DETAILS.PMPREM,		/*NBPT*/
POL_DETAILS.LPRL,		/*NBPT*/
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_1,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_2,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_3,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_4,
POL_DETAILS.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_GENDER, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
RPD.POLICY_NUMBER,
RPD.POLICY_EFFECTIVE_DATE,
RPD.POLICY_ISSUE_DATE,
RPD.POLICY_TERMINATION_DATE,
RPD.SUBMISSION_DATE,
RPD.CURRENCY,
RPD.POLICY_STATUS,
RPD.DIVIDEND_OPTION,
RPD.ACCUMULATED_DIVIDEND,
RPD.ACCUMULATED_DIV_INTRST,
RPD.ADDITIONAL_PAID_UP_AMOUNT,
RPD.FACE_VAL_ON_RVRSNRY_BONUS,
RPD.FACE_VAL_ON_TRMNL_BONUS,
RPD.BONUS_IN_FACE_VALUE_AMOUNT,
RPD.ADDITIONAL_PAID_UP_FACE_VALUE,
RPD.COUPON_AMOUNT,
RPD.DATE_OF_COST_INS_UPD,
RPD.LOAN_BALANCE,
RPD.LOAN_BLNCE_INTEREST,
RPD.DEATH_BNFT_OPTIONS,
RPD.INDEXATION_STATE,
RPD.POLICY_INDEXATION_TYPE,
RPD.COMMUNICATION_MEANS,
RPD.SMS,
RPD.SUS_SMS,
RPD.SUS_EMAIL,
RPD.ESERVICE_INDICATOR,
RPD.MAE_OPTION_CODE,
RPD.COUPON_INTEREST,
RPD.REDUCED_PAID_UP,
RPD.PURE_ENDOWMENT,
RPD.ETA_EXPIRY_DATE,
RPD.ASSIGNEE_TYPE_CODE,
RPD.PLAN_CODE,
RPD.EXPIRY_DATE,
RPD.INITIAL_LS_PREMIUM,
RPD.REGULAR_TOPUP_PREMIUM,
RPD.FUTURE_PREMIUM_DEPOSIT,
RPD.MODAL_PREMIUM,
RPD.FUTURE_PREM_DEPOSIT_INTEREST,
RPD.PREMIUM_DUE_DATE,
RPD.PREMIUM_HOLIDAY_START,
RPD.PREMIUM_HOLIDAY_END,
RPD.PAYMENT_MODE_CD,
RPD.PAYMENT_METHOD,
RPD.OWNER_LAST_NAME,
RPD.OWNER_PARTY_TYP_CD,
RPD.OWNER_PARTY_ID,
RPD.OWNER_ID_DOC_NUMBER, 
RPD.ID_DOCUMENT_TYPE,
RPD.INSRD_LAST_NAME,
RPD.DATE_OF_BIRTH,
RPD.GENDER,
RPD.INSRD_PARTY_TYP_CD,
RPD.INSRD_PARTY_ID, 
RPD.INS_ID_DOCUMENT_NUMBER,
RPD.ASSIGNEE_NAME,
RPD.ASSIGNEE_TYPE,
RPD.PRODUCING_AGENT_CD_1,
RPD.PRODUCING_AGENT_CD_2,
RPD.SERVICING_AGENT_CD_1,
RPD.SERVICING_AGENT_CD_2,
RPD.ACTUAL_SERVICING_AGENT,
RPD.SUM_INSURED,
RPD.TOTAL_SUM_INSURED,
RPD.BASIC_SUM_INSURED,
RPD.POLICY_TYPE,
RPD.TOTAL_AMOUNT,
--RPD.WITHDRAWAL_AMOUNT,
RPD.PREMIUM_OVERDUE,
RPD.PREMIUM_HOLIDAY_INDICATOR,
RPD.REINSTATEMENT_EFF_DATE,
RPD.EFF_POLICY_CHANGE_DATE,
RPD.TRANS_DATE,
RPD.ACTUAL_TERM_DATE,
RPD.MODAL_COMMISSION,
RPD.COMMISSION_RATE,
RPD.PAID_TO_DATE,
RPD.CLASS_CODE,
RPD.CSC_CODE,
RPD.POLICY_ADDRESS_LINE_1,
RPD.POLICY_ADDRESS_LINE_2,
RPD.POLICY_ADDRESS_LINE_3,
RPD.POLICY_ADDRESS_LINE_4,
RPD.CHINESE_POLICY_ADDRESS_LINE_1,
RPD.CHINESE_POLICY_ADDRESS_LINE_2,
RPD.CHINESE_POLICY_ADDRESS_LINE_3,
RPD.CHINESE_POLICY_ADDRESS_LINE_4,
RPD.ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
RPD.EXCLUSION,
RPD.TEMP_LOADING,
RPD.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_1,			    /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
RPD.ASSIGNEE_CITY,                  /*  DAPH-1192  */
RPD.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
RPD.MAINTENANCE_CD,                 /*  DAPH-1192  */
RPD.SOURCE_CD,						/*  DAPH-1192  */
RPD.LILSP,		/*NBPT*/
RPD.LBPRM,		/*NBPT*/
RPD.PMPREM,		/*NBPT*/
RPD.LPRL,		/*NBPT*/
RPD.CHINESE_ASSIGNEE_ADDRESS_1,
RPD.CHINESE_ASSIGNEE_ADDRESS_2,
RPD.CHINESE_ASSIGNEE_ADDRESS_3,
RPD.CHINESE_ASSIGNEE_ADDRESS_4,
RPD.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPD.OWNER_GENDER, /* DASI ENHANCEMENT */
RPD.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPD.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_INS, /* DASI ENHANCEMENT */
ROW_NUMBER() OVER (PARTITION BY RPD.POLICY_NUMBER, RPD.POLICY_EFFECTIVE_DATE ORDER BY RPD.TRANS_DATE DESC) AS REC_CNT
FROM
(
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.POLICY_EFFECTIVE_DATE,
RPOL.POLICY_ISSUE_DATE,
RPOL.POLICY_TERMINATION_DATE,
RPOL.SUBMISSION_DATE,
RPOL.PCCY  AS CURRENCY,
RPOL.PSTU  AS POLICY_STATUS,
RPOL.LDVDO  AS DIVIDEND_OPTION,
RPOL.LDVDB  AS ACCUMULATED_DIVIDEND,
RPOL.LDVDI  AS ACCUMULATED_DIV_INTRST,
RPOL.ADDITIONAL_PAID_UP_AMOUNT,
RPOL.LTRB  AS FACE_VAL_ON_RVRSNRY_BONUS,
RPOL.LTTB  AS FACE_VAL_ON_TRMNL_BONUS,
RPOL.BONUS_IN_FACE_VALUE_AMOUNT,
RPOL.ADDITIONAL_PAID_UP_FACE_VALUE,
RPOL.LSCHB AS COUPON_AMOUNT,
RPOL.DATE_OF_COST_INS_UPD,
RPOL.LLOAN AS LOAN_BALANCE,
RPOL.LLNI AS LOAN_BLNCE_INTEREST,
RPOL.LDTHBO AS DEATH_BNFT_OPTIONS,
RPOL.INDEXATION_STATE,
RPOL.POLICY_INDEXATION_TYPE,
RPOL.PCOMM AS COMMUNICATION_MEANS,
RPOL.PSMS AS SMS,
RPOL.PSUSPS AS SUS_SMS,
RPOL.PSUSPE AS SUS_EMAIL,
RPOL.PAESF AS ESERVICE_INDICATOR,
RPOL.LMAEO AS MAE_OPTION_CODE,
RPOL.LSCHI AS COUPON_INTEREST,
RPOL.LRPUP AS REDUCED_PAID_UP,
RPOL.LENDT AS PURE_ENDOWMENT,
RPOL.ETA_EXPIRY_DATE,
RPOL.ASSIGNEE_TYPE_CODE,
RPOL.LPLAN AS PLAN_CODE,
RPOL.PEXP AS EXPIRY_DATE,
RPOL.LIILP AS INITIAL_LS_PREMIUM,
RPOL.LTRMP AS REGULAR_TOPUP_PREMIUM,
RPOL.LFPDB AS FUTURE_PREMIUM_DEPOSIT,
RPOL.MODAL_PREMIUM,
RPOL.LFPDI  AS FUTURE_PREM_DEPOSIT_INTEREST,
RPOL.PPTD AS PREMIUM_DUE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(RPOL.LPHOFD)),1,TO_DATE(TO_CHAR(RPOL.LPHOFD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PREMIUM_HOLIDAY_START,
DECODE(IS_DATE_DAPI(TO_CHAR(RPOL.LPHOTD)),1,TO_DATE(TO_CHAR(RPOL.LPHOTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PREMIUM_HOLIDAY_END,
RPOL.PMODE AS PAYMENT_MODE_CD,
RPOL.PMTHOD AS PAYMENT_METHOD,
RPOL.POWNER AS OWNER_LAST_NAME,
RPOL.OWNER_PARTY_TYP_CD,
CASE WHEN RPOL.POWNER IS NOT NULL OR RPOL.POWNID IS NOT NULL THEN(RPOL.PNO|| ':OWN') ELSE NULL END AS OWNER_PARTY_ID,
RPOL.POWNID AS OWNER_ID_DOC_NUMBER, 
'SECURITYNO' AS ID_DOCUMENT_TYPE,
RPOL.PNAME AS INSRD_LAST_NAME,
RPOL.DATE_OF_BIRTH,
RPOL.PSEX AS GENDER,
RPOL.INSRD_PARTY_TYP_CD,
(RPOL.PNO|| ':INS') AS INSRD_PARTY_ID, 
RPOL.PID AS INS_ID_DOCUMENT_NUMBER,
RPOL.LASSGN AS ASSIGNEE_NAME,
RPOL.ASSIGNEE_TYPE,
CASE 
	WHEN TRIM(RPOL.PPAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT1,-(LENGTH(PPAGT1)),(LENGTH(PPAGT1)-8))||'-'||SUBSTR(RPOL.PPAGT1,-8,2)||'-'||SUBSTR(RPOL.PPAGT1,-6) 
END AS PRODUCING_AGENT_CD_1,
CASE 
	WHEN TRIM(RPOL.PPAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT2,-(LENGTH(PPAGT2)),(LENGTH(PPAGT2)-8))||'-'||SUBSTR(RPOL.PPAGT2,-8,2)||'-'||SUBSTR(RPOL.PPAGT2,-6) 
END AS PRODUCING_AGENT_CD_2,
CASE 
	WHEN TRIM(RPOL.PAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT1,-(LENGTH(PAGT1)),(LENGTH(PAGT1)-8))||'-'||SUBSTR(RPOL.PAGT1,-8,2)||'-'||SUBSTR(RPOL.PAGT1,-6) 
END AS SERVICING_AGENT_CD_1,
CASE 
	WHEN TRIM(RPOL.PAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT2,-(LENGTH(PAGT2)),(LENGTH(PAGT2)-8))||'-'||SUBSTR(RPOL.PAGT2,-8,2)||'-'||SUBSTR(RPOL.PAGT2,-6) 
END AS SERVICING_AGENT_CD_2,
RPOL.ACTUAL_SERVICING_AGENT,
RPOL.SUM_INSURED,
RPOL.LTSI AS TOTAL_SUM_INSURED,
RPOL.BASIC_SUM_INSURED,
RPOL.POLICY_TYPE,
RPOL.TOTAL_AMOUNT,
--RPOL.WITHDRAWAL_AMOUNT,
RPOL.PREMIUM_OVERDUE,
RPOL.PREMIUM_HOLIDAY_INDICATOR,
RPOL.REINSTATEMENT_EFF_DATE,
RPOL.EFF_POLICY_CHANGE_DATE,
RPOL.TRANS_DATE,
RPOL.ACTUAL_TERM_DATE,
RPOL.PMCOMM AS MODAL_COMMISSION,
RPOL.COMMISSION_RATE,
RPOL.PAID_TO_DATE,
RPOL.CLASS_CODE,
RPOL.CSC_CODE,
RPOL.PADR1 AS POLICY_ADDRESS_LINE_1,
RPOL.PADR2 AS POLICY_ADDRESS_LINE_2,
RPOL.PADR3 AS POLICY_ADDRESS_LINE_3,
RPOL.PADR4 AS POLICY_ADDRESS_LINE_4,
RPOL.E59PCCA1 AS CHINESE_POLICY_ADDRESS_LINE_1,
RPOL.E59PCCA2 AS CHINESE_POLICY_ADDRESS_LINE_2,
RPOL.E59PCCA3 AS CHINESE_POLICY_ADDRESS_LINE_3,
RPOL.E59PCCA4 AS CHINESE_POLICY_ADDRESS_LINE_4,
RPOL.ACTIVITY_SUSPENSION_FLG,			/* DATH-686 */
RPOL.LEXCL AS EXCLUSION,
RPOL.LPRLT AS TEMP_LOADING,
RPOL.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
RPOL.ASSIGNEE_ADDRESS_1,                /*  DAPH-1192  */
RPOL.ASSIGNEE_ADDRESS_2,                /*  DAPH-1192  */
RPOL.ASSIGNEE_ADDRESS_3,                /*  DAPH-1192  */
RPOL.ASSIGNEE_ADDRESS_4,                /*  DAPH-1192  */
RPOL.ASSIGNEE_CITY,                     /*  DAPH-1192  */
RPOL.EXP_DATE_OF_TEMP_LOADING,          /*  DAPH-1192  */
RPOL.MAINTENANCE_CD,                    /*  DAPH-1192  */
RPOL.SOURCE_CD,                          /*  DAPH-1192  */
RPOL.LILSP,		/*NBPT*/
RPOL.LBPRM,		/*NBPT*/
RPOL.PMPREM,		/*NBPT*/
RPOL.LPRL,		/*NBPT*/
RPOL.E59PCAA1 AS CHINESE_ASSIGNEE_ADDRESS_1,
RPOL.E59PCAA2 AS CHINESE_ASSIGNEE_ADDRESS_2,
RPOL.E59PCAA3 AS CHINESE_ASSIGNEE_ADDRESS_3,
RPOL.E59PCAA4 AS CHINESE_ASSIGNEE_ADDRESS_4,
RPOL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPOL.OWNER_GENDER, /* DASI ENHANCEMENT */
RPOL.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPOL.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
POL.PNO,
POL.POLICY_EFFECTIVE_DATE,
POL.POLICY_ISSUE_DATE,
POL.POLICY_TERMINATION_DATE,
POL.SUBMISSION_DATE,
POL.PCCY ,
POL.PSTU ,
POL.LDVDO,
POL.LDVDB,
POL.LDVDI,
POL.ADDITIONAL_PAID_UP_AMOUNT,
POL.LTRB ,
POL.LTTB ,
POL.BONUS_IN_FACE_VALUE_AMOUNT,
POL.ADDITIONAL_PAID_UP_FACE_VALUE,
POL.LSCHB,
POL.DATE_OF_COST_INS_UPD,
POL.LLOAN,
POL.LLNI,
POL.LDTHBO,
POL.INDEXATION_STATE,
POL.POLICY_INDEXATION_TYPE,
POL.PCOMM,
POL.PSMS,
POL.PSUSPS,
POL.PSUSPE,
POL.PAESF,
POL.LMAEO,
POL.LSCHI,
POL.LRPUP ,
POL.LENDT,
POL.ETA_EXPIRY_DATE,
POL.ASSIGNEE_TYPE_CODE,
POL.LPLAN,
POL.PEXP,
POL.LIILP,
POL.LTRMP,
POL.LFPDB ,
POL.MODAL_PREMIUM,
POL.LFPDI ,
POL.PPTD,
POL.LPHOFD,
POL.LPHOTD,
POL.PMODE,
POL.PMTHOD,
POL.POWNER,
POL.OWNER_PARTY_TYP_CD,
POL.POWNID,
POL.PADR1,
POL.PADR2,
POL.PADR3,
POL.PADR4,
POL.HOME_ADDRESS_TYPE,
POL.PNAME,
POL.DATE_OF_BIRTH,
POL.PSEX,
POL.INSRD_PARTY_TYP_CD,
POL.PID,
POL.HOME_TELEPHONE ,
POL.OFFICE_TELEPHONE,
POL.HOME_TLPHN_ADDR_TYP_CD,
POL.MOB_TLPHN_ADDR_TYP_CD,
POL.OFF_TLPHN_ADDR_TYP_CD,
POL.LSA,
POL.ELCTRNC_ADDR_TYP_CD,
POL.LASSGN,
POL.ASSIGNEE_TYPE,
POL.PPAGT1,
POL.PPAGT2,
POL.PAGT1,
POL.PAGT2,
POL.ACTUAL_SERVICING_AGENT,
POL.SUM_INSURED,
POL.LTSI,
POL.BASIC_SUM_INSURED,
POL.POLICY_TYPE,
CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' THEN LFPODSAS.ASSURV
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) THEN LFPODSPS.PSTAMT
END TOTAL_AMOUNT,
/*CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' AND LFPUFTD.N9TCOD='AW' AND LFPUFTDH.M2TCOD='AW' THEN (LFPUFTD.N9AMTP + LFPUFTDH.M2AMTP)
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) AND (LFPACT.ACTCD LIKE 'AW%' OR LFPACTC.ACTCD LIKE 'AW%') THEN (NVL(LFPACT.ACAMT,0) + NVL(LFPACTC.ACAMT,0))
END AS WITHDRAWAL_AMOUNT,*/
POL.PREMIUM_OVERDUE,
POL.PREMIUM_HOLIDAY_INDICATOR,
POL.REINSTATEMENT_EFF_DATE,
POL.EFF_POLICY_CHANGE_DATE,
POL.TRANS_DATE,
POL.TERMINATE_DATE,
POL.ACTUAL_TERM_DATE,
POL.PMCOMM,
POL.COMMISSION_RATE,
POL.PAID_TO_DATE,
POL.CLASS_CODE,
POL.CSC_CODE,
LFPTCINF.E59PCCA1,
LFPTCINF.E59PCCA2,
LFPTCINF.E59PCCA3,
LFPTCINF.E59PCCA4,
POL.ACTIVITY_SUSPENSION_FLG,			/* DATH-686 */
POL.LEXCL,
POL.LPRLT,
POL.NON_FORFEITURE_OPT,					/*  DAPH-1192  */
POL.ASSIGNEE_ADDRESS_1,                 /*  DAPH-1192  */
POL.ASSIGNEE_ADDRESS_2,                 /*  DAPH-1192  */
POL.ASSIGNEE_ADDRESS_3,                 /*  DAPH-1192  */
POL.ASSIGNEE_ADDRESS_4,                 /*  DAPH-1192  */
POL.ASSIGNEE_CITY,                      /*  DAPH-1192  */
POL.EXP_DATE_OF_TEMP_LOADING,           /*  DAPH-1192  */
POL.MAINTENANCE_CD,                     /*  DAPH-1192  */
POL.SOURCE_CD,                           /*  DAPH-1192  */
POL.LILSP,		/*NBPT*/
POL.LBPRM,		/*NBPT*/
POL.PMPREM,		/*NBPT*/
POL.LPRL,		/*NBPT*/
LFPTCINF.E59PCAA1,
LFPTCINF.E59PCAA2,
LFPTCINF.E59PCAA3,
LFPTCINF.E59PCAA4,
POL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL.OWNER_GENDER, /* DASI ENHANCEMENT */
POL.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(

SELECT
LFPPML.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PEFF)),1,TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_EFFECTIVE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PDOI)),1,TO_DATE(TO_CHAR(LFPPML.PDOI),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_ISSUE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PTERM)),1,TO_DATE(TO_CHAR(LFPPML.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_TERMINATION_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PDOS)),1,TO_DATE(TO_CHAR(LFPPML.PDOS),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS SUBMISSION_DATE,
LFPPML.PCCY ,
LFPPML.PSTU ,
LFPPML.LDVDO,
LFPPML.LDVDB,
LFPPML.LDVDI,
LFPPML.LAPUP AS ADDITIONAL_PAID_UP_AMOUNT,
LFPPML.LTRB ,
LFPPML.LTTB ,
(LFPPML.LTRB + LFPPML.LTTB) AS   BONUS_IN_FACE_VALUE_AMOUNT,
LFPPML.LAPUP AS ADDITIONAL_PAID_UP_FACE_VALUE,
LFPPML.LSCHB,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.LCOIDT)),1,TO_DATE(TO_CHAR(LFPPML.LCOIDT),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS DATE_OF_COST_INS_UPD,
LFPPML.LLOAN,
LFPPML.LLNI,
LFPPML.LDTHBO,
LFPPML.LINXO AS INDEXATION_STATE,
LFPPML.LINXO AS POLICY_INDEXATION_TYPE,
LFPPML.PCOMM,
LFPPML.PSMS,
LFPPML.PSUSPS,
LFPPML.PSUSPE,
LFPPML.PAESF,
LFPPML.LMAEO,
LFPPML.LSCHI,
LFPPML.LRPUP ,
LFPPML.LENDT,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.LETA)),1,TO_DATE(TO_CHAR(LFPPML.LETA),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS ETA_EXPIRY_DATE,
LFPPML.LASNCD AS ASSIGNEE_TYPE_CODE,
LFPPML.LPLAN,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PEXP)),1,TO_DATE(TO_CHAR(LFPPML.PEXP),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PEXP,
LFPPML.LIILP,
LFPPML.LTRMP,
LFPPML.LFPDB ,
LFPPML.LTBPRM AS MODAL_PREMIUM,
LFPPML.LFPDI ,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PPTD)),1,TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PPTD,
LFPPML.LPHOFD,
LFPPML.LPHOTD,
LFPPML.PMODE,
LFPPML.PMTHOD,
LFPPML.POWNER,
'OWN' AS OWNER_PARTY_TYP_CD,
LFPPML.POWNID,
LFPPML.PADR1,
LFPPML.PADR2,
LFPPML.PADR3,
LFPPML.PADR4,
'HOM' AS HOME_ADDRESS_TYPE,
LFPPML.PNAME,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PDOB)),1,TO_DATE(TO_CHAR(LFPPML.PDOB),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS DATE_OF_BIRTH,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PPTD)),1,TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PAID_TO_DATE,
LFPPML.LCLS AS CLASS_CODE,
LFPPML.PCSCD AS CSC_CODE,
LFPPML.PSEX,
'INS' AS INSRD_PARTY_TYP_CD,
LFPPML.PID,
LFPPML.PTEL1 AS HOME_TELEPHONE ,
LFPPML.PTEL2 AS OFFICE_TELEPHONE,
'HOM' AS HOME_TLPHN_ADDR_TYP_CD,
'MOB' AS MOB_TLPHN_ADDR_TYP_CD,
'OFF' AS OFF_TLPHN_ADDR_TYP_CD,
LFPPML.LSA,
'EML' AS ELCTRNC_ADDR_TYP_CD,
LFPPML.LASSGN,
LFPPML.LASNCD AS ASSIGNEE_TYPE,
LFPPML.PPAGT1,
LFPPML.PPAGT2,
LFPPML.PAGT1,
LFPPML.PAGT2,
CASE
	WHEN SATB.LFASA IS NOT NULL THEN SUBSTR(LFASA,-(LENGTH(LFASA)),(LENGTH(LFASA)-8))||'-'||SUBSTR(LFASA,-8,2)||'-'||SUBSTR(LFASA,-6)
	ELSE NULL
END ACTUAL_SERVICING_AGENT,
LFPPML.LSA AS SUM_INSURED,
LFPPML.LTSI,
LFPPML.LSA AS BASIC_SUM_INSURED,
CASE
	WHEN TBP.PLSBGP IN ('16','17') THEN 'TERM PLAN'
	WHEN TBP.PLSBGP IN ('11','12', '13') THEN 'WHOLE LIFE'
	WHEN TBP.PLSBGP IN ('14','15') THEN 'ENDOWMENT'
	WHEN TBP.PLSBGP IN ('33','34') THEN 'HEALTH/HOSPITAL'
	WHEN TBP.PLSBGP = '18' THEN 'UNIT LINK'
	ELSE 'TRADITIONAL'
END POLICY_TYPE,
CASE
	WHEN (DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PPTD)),1,TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD')) < TRUNC(SYSDATE) AND LFPPML.PSTU NOT IN('2','3','4','7','8','9','A','C','D','E','Z')) THEN 'YES'
	ELSE 'NO'
END PREMIUM_OVERDUE,
CASE
	WHEN ((LFPPML.LPHOFD!=0 AND LFPPML.LPHOTD = 0) OR (LFPPML.LPHOFD != 0 AND  LFPPML.LPHOTD >= LFPPML.PPTD)) THEN 'Y'
	ELSE 'N'
END AS PREMIUM_HOLIDAY_INDICATOR,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PREFF)),1,TO_DATE(TO_CHAR(LFPPML.PREFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS REINSTATEMENT_EFF_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PTEFF)),1,TO_DATE(TO_CHAR(LFPPML.PTEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS EFF_POLICY_CHANGE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PDOT)),1,TO_DATE(TO_CHAR(LFPPML.PDOT),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TRANS_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PTERM)),1,TO_DATE(TO_CHAR(LFPPML.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TERMINATE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PATERM)),1,TO_DATE(TO_CHAR(LFPPML.PATERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS ACTUAL_TERM_DATE,
LFPPML.PMCOMM,
CASE
  WHEN IS_DATE_DAPI(TO_CHAR(LFPPML.PEFF))=0 THEN PAGTC11
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 1) OR (IS_DATE_DAPI(TO_CHAR(LFPPML.PPTD))=0) THEN PAGTC1
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 2) THEN PAGTC2
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 3) THEN PAGTC3
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 4) THEN PAGTC4
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 5) THEN PAGTC5
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 6) THEN PAGTC6
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 7) THEN PAGTC7
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 8) THEN PAGTC8
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 9) THEN PAGTC9
	WHEN ((TO_DATE(TO_CHAR(LFPPML.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYYMMDD'))/365 <= 10) THEN PAGTC10
	ELSE PAGTC11
END AS COMMISSION_RATE,
LFPPML.PSUSF AS ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
LFPPML.LEXCL,
LFPPML.LPRLT,
LFPPML.LNFO AS NON_FORFEITURE_OPT,				/*  DAPH-1192  */
LFPPML.LASSA1 AS ASSIGNEE_ADDRESS_1,            /*  DAPH-1192  */
LFPPML.LASSA2 AS ASSIGNEE_ADDRESS_2,            /*  DAPH-1192  */
LFPPML.LASSA3 AS ASSIGNEE_ADDRESS_3,            /*  DAPH-1192  */
LFPPML.LASSA4 AS ASSIGNEE_ADDRESS_4,            /*  DAPH-1192  */
LFPPML.LASCTY AS ASSIGNEE_CITY,                 /*  DAPH-1192  */
LFPPML.LPRLTE AS EXP_DATE_OF_TEMP_LOADING,      /*  DAPH-1192  */
LFPPML.PTC AS MAINTENANCE_CD,                   /*  DAPH-1192  */
LFPPML.PSOUR AS SOURCE_CD,                      /*  DAPH-1192  */
LFPPML.LILSP,		/*NBPT*/
LFPPML.LBPRM,		/*NBPT*/
LFPPML.PMPREM,		/*NBPT*/
LFPPML.LPRL,		/*NBPT*/
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.LPAYDB)),1,TO_DATE(TO_CHAR(LFPPML.LPAYDB),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
LFPPML.POWSEX AS OWNER_GENDER, /* DASI ENHANCEMENT */
LFPPML.PMOMBNO AS OWNER_MOBILE, /* DASI ENHANCEMENT */
LFPPML.PEMAL AS OWNER_EMAIL, /* DASI ENHANCEMENT */
CASE WHEN TRIM(LFPPML.POWNER) IS NOT NULL THEN 'OWN' END AS PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
'INS' AS PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
MR_LFPPML LFPPML
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPML.LPLAN = TBP.PLAN
LEFT OUTER JOIN MR_LFPASATB SATB
ON LFPPML.PNO=SATB.LFPNO
WHERE LFPPML.PNO = '%policyNumber%'  /*POLICY NUMBER*/
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PEFF)),1,TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD'))>= TO_DATE('1900-01-01','YYYY-MM-DD') 	/* INPUT POLICY_EFFECTIVE_FROM_DATE */
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPML.PEFF)),1,TO_DATE(TO_CHAR(LFPPML.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) <= TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD') 	/* INPUT POLICY_EFFECTIVE_TO_DATE */
)POL
LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
/*LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO*/
LEFT OUTER JOIN MR_LFPTCINF LFPTCINF
ON POL.PNO=LFPTCINF.E59PNO
)RPOL
)RPD
) POL_DETAILS
WHERE POL_DETAILS.REC_CNT = 1


UNION ALL

SELECT
POL_DETAILS.POLICY_NUMBER,
POL_DETAILS.POLICY_EFFECTIVE_DATE,
POL_DETAILS.POLICY_ISSUE_DATE,
POL_DETAILS.POLICY_TERMINATION_DATE,
POL_DETAILS.SUBMISSION_DATE,
POL_DETAILS.CURRENCY,
POL_DETAILS.POLICY_STATUS,
POL_DETAILS.DIVIDEND_OPTION,
POL_DETAILS.ACCUMULATED_DIVIDEND,
POL_DETAILS.ACCUMULATED_DIV_INTRST,
POL_DETAILS.ADDITIONAL_PAID_UP_AMOUNT,
POL_DETAILS.FACE_VAL_ON_RVRSNRY_BONUS,
POL_DETAILS.FACE_VAL_ON_TRMNL_BONUS,
POL_DETAILS.BONUS_IN_FACE_VALUE_AMOUNT,
POL_DETAILS.ADDITIONAL_PAID_UP_FACE_VALUE,
POL_DETAILS.COUPON_AMOUNT,
POL_DETAILS.DATE_OF_COST_INS_UPD,
POL_DETAILS.LOAN_BALANCE,
POL_DETAILS.LOAN_BLNCE_INTEREST,
POL_DETAILS.DEATH_BNFT_OPTIONS,
POL_DETAILS.INDEXATION_STATE,
POL_DETAILS.POLICY_INDEXATION_TYPE,
POL_DETAILS.COMMUNICATION_MEANS,
POL_DETAILS.SMS,
POL_DETAILS.SUS_SMS,
POL_DETAILS.SUS_EMAIL,
POL_DETAILS.ESERVICE_INDICATOR,
POL_DETAILS.MAE_OPTION_CODE,
POL_DETAILS.COUPON_INTEREST,
POL_DETAILS.REDUCED_PAID_UP,
POL_DETAILS.PURE_ENDOWMENT,
POL_DETAILS.ETA_EXPIRY_DATE,
POL_DETAILS.ASSIGNEE_TYPE_CODE,
POL_DETAILS.PLAN_CODE,
POL_DETAILS.EXPIRY_DATE,
POL_DETAILS.INITIAL_LS_PREMIUM,
POL_DETAILS.REGULAR_TOPUP_PREMIUM,
POL_DETAILS.FUTURE_PREMIUM_DEPOSIT,
POL_DETAILS.MODAL_PREMIUM,
POL_DETAILS.FUTURE_PREM_DEPOSIT_INTEREST,
POL_DETAILS.PREMIUM_DUE_DATE,
POL_DETAILS.PREMIUM_HOLIDAY_START,
POL_DETAILS.PREMIUM_HOLIDAY_END,
POL_DETAILS.PAYMENT_MODE_CD,
POL_DETAILS.PAYMENT_METHOD,
POL_DETAILS.OWNER_LAST_NAME,
POL_DETAILS.OWNER_PARTY_TYP_CD,
POL_DETAILS.OWNER_PARTY_ID,
POL_DETAILS.OWNER_ID_DOC_NUMBER,
POL_DETAILS.ID_DOCUMENT_TYPE,
POL_DETAILS.INSRD_LAST_NAME,
POL_DETAILS.DATE_OF_BIRTH,
POL_DETAILS.GENDER,
POL_DETAILS.INSRD_PARTY_TYP_CD,
POL_DETAILS.INSRD_PARTY_ID,
POL_DETAILS.INS_ID_DOCUMENT_NUMBER,
POL_DETAILS.ASSIGNEE_NAME,
POL_DETAILS.ASSIGNEE_TYPE,
POL_DETAILS.PRODUCING_AGENT_CD_1,
POL_DETAILS.PRODUCING_AGENT_CD_2,
POL_DETAILS.SERVICING_AGENT_CD_1,
POL_DETAILS.SERVICING_AGENT_CD_2,
POL_DETAILS.SUM_INSURED,
POL_DETAILS.TOTAL_SUM_INSURED,
POL_DETAILS.BASIC_SUM_INSURED,
POL_DETAILS.POLICY_TYPE,
POL_DETAILS.TOTAL_AMOUNT,
--POL_DETAILS.WITHDRAWAL_AMOUNT,
POL_DETAILS.PREMIUM_OVERDUE,
POL_DETAILS.PREMIUM_HOLIDAY_INDICATOR,
POL_DETAILS.REINSTATEMENT_EFF_DATE,
POL_DETAILS.EFF_POLICY_CHANGE_DATE,
POL_DETAILS.TRANS_DATE,
POL_DETAILS.ACTUAL_TERM_DATE,
POL_DETAILS.MODAL_COMMISSION,
POL_DETAILS.COMMISSION_RATE,
POL_DETAILS.PAID_TO_DATE,
POL_DETAILS.CLASS_CODE,
POL_DETAILS.CSC_CODE,
POL_DETAILS.POLICY_ADDRESS_LINE_1,
POL_DETAILS.POLICY_ADDRESS_LINE_2,
POL_DETAILS.POLICY_ADDRESS_LINE_3,
POL_DETAILS.POLICY_ADDRESS_LINE_4,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_1,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_2,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_3,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_4,
POL_DETAILS.ACTIVITY_SUSPENSION_FLG	,		/* DATH-686 */
POL_DETAILS.EXCLUSION, /*DAHK-573*/
POL_DETAILS.TEMP_LOADING, /*DAHK-573*/
POL_DETAILS.ACTUAL_SERVICING_AGENT /*DAHK-1853*/,
POL_DETAILS.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_1,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_CITY,                  /*  DAPH-1192  */
POL_DETAILS.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
POL_DETAILS.MAINTENANCE_CD,                 /*  DAPH-1192  */
POL_DETAILS.SOURCE_CD,                       /*  DAPH-1192  */
POL_DETAILS.LILSP,		/*NBPT*/
POL_DETAILS.LBPRM,		/*NBPT*/
POL_DETAILS.PMPREM,		/*NBPT*/
POL_DETAILS.LPRL,		/*NBPT*/
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_1,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_2,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_3,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_4,
POL_DETAILS.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_GENDER, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
RPD.POLICY_NUMBER,
RPD.POLICY_EFFECTIVE_DATE,
RPD.POLICY_ISSUE_DATE,
RPD.POLICY_TERMINATION_DATE,
RPD.SUBMISSION_DATE,
RPD.CURRENCY,
RPD.POLICY_STATUS,
RPD.DIVIDEND_OPTION,
RPD.ACCUMULATED_DIVIDEND,
RPD.ACCUMULATED_DIV_INTRST,
RPD.ADDITIONAL_PAID_UP_AMOUNT,
RPD.FACE_VAL_ON_RVRSNRY_BONUS,
RPD.FACE_VAL_ON_TRMNL_BONUS,
RPD.BONUS_IN_FACE_VALUE_AMOUNT,
RPD.ADDITIONAL_PAID_UP_FACE_VALUE,
RPD.COUPON_AMOUNT,
RPD.DATE_OF_COST_INS_UPD,
RPD.LOAN_BALANCE,
RPD.LOAN_BLNCE_INTEREST,
RPD.DEATH_BNFT_OPTIONS,
RPD.INDEXATION_STATE,
RPD.POLICY_INDEXATION_TYPE,
RPD.COMMUNICATION_MEANS,
RPD.SMS,
RPD.SUS_SMS,
RPD.SUS_EMAIL,
RPD.ESERVICE_INDICATOR,
RPD.MAE_OPTION_CODE,
RPD.COUPON_INTEREST,
RPD.REDUCED_PAID_UP,
RPD.PURE_ENDOWMENT,
RPD.ETA_EXPIRY_DATE,
RPD.ASSIGNEE_TYPE_CODE,
RPD.PLAN_CODE,
RPD.EXPIRY_DATE,
RPD.INITIAL_LS_PREMIUM,
RPD.REGULAR_TOPUP_PREMIUM,
RPD.FUTURE_PREMIUM_DEPOSIT,
RPD.MODAL_PREMIUM,
RPD.FUTURE_PREM_DEPOSIT_INTEREST,
RPD.PREMIUM_DUE_DATE,
RPD.PREMIUM_HOLIDAY_START,
RPD.PREMIUM_HOLIDAY_END,
RPD.PAYMENT_MODE_CD,
RPD.PAYMENT_METHOD,
RPD.OWNER_LAST_NAME,
RPD.OWNER_PARTY_TYP_CD,
RPD.OWNER_PARTY_ID,
RPD.OWNER_ID_DOC_NUMBER,
RPD.ID_DOCUMENT_TYPE,
RPD.INSRD_LAST_NAME,
RPD.DATE_OF_BIRTH,
RPD.GENDER,
RPD.INSRD_PARTY_TYP_CD,
RPD.INSRD_PARTY_ID,
RPD.INS_ID_DOCUMENT_NUMBER,
RPD.ASSIGNEE_NAME,
RPD.ASSIGNEE_TYPE,
RPD.PRODUCING_AGENT_CD_1,
RPD.PRODUCING_AGENT_CD_2,
RPD.SERVICING_AGENT_CD_1,
RPD.SERVICING_AGENT_CD_2,
RPD.ACTUAL_SERVICING_AGENT,
RPD.SUM_INSURED,
RPD.TOTAL_SUM_INSURED,
RPD.BASIC_SUM_INSURED,
RPD.POLICY_TYPE,
RPD.TOTAL_AMOUNT,
--RPD.WITHDRAWAL_AMOUNT,
RPD.PREMIUM_OVERDUE,
RPD.PREMIUM_HOLIDAY_INDICATOR,
RPD.REINSTATEMENT_EFF_DATE,
RPD.EFF_POLICY_CHANGE_DATE,
RPD.TRANS_DATE,
RPD.ACTUAL_TERM_DATE,
RPD.MODAL_COMMISSION,
RPD.COMMISSION_RATE,
RPD.PAID_TO_DATE,
RPD.CLASS_CODE,
RPD.CSC_CODE,
RPD.POLICY_ADDRESS_LINE_1,
RPD.POLICY_ADDRESS_LINE_2,
RPD.POLICY_ADDRESS_LINE_3,
RPD.POLICY_ADDRESS_LINE_4,
RPD.CHINESE_POLICY_ADDRESS_LINE_1,
RPD.CHINESE_POLICY_ADDRESS_LINE_2,
RPD.CHINESE_POLICY_ADDRESS_LINE_3,
RPD.CHINESE_POLICY_ADDRESS_LINE_4,
RPD.ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
RPD.EXCLUSION,
RPD.TEMP_LOADING,
RPD.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_1,			    /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
RPD.ASSIGNEE_CITY,                  /*  DAPH-1192  */
RPD.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
RPD.MAINTENANCE_CD,                 /*  DAPH-1192  */
RPD.SOURCE_CD,						/*  DAPH-1192  */
RPD.LILSP,		/*NBPT*/
RPD.LBPRM,		/*NBPT*/
RPD.PMPREM,		/*NBPT*/
RPD.LPRL,		/*NBPT*/
RPD.CHINESE_ASSIGNEE_ADDRESS_1,
RPD.CHINESE_ASSIGNEE_ADDRESS_2,
RPD.CHINESE_ASSIGNEE_ADDRESS_3,
RPD.CHINESE_ASSIGNEE_ADDRESS_4,
RPD.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPD.OWNER_GENDER, /* DASI ENHANCEMENT */
RPD.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPD.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_INS, /* DASI ENHANCEMENT */
ROW_NUMBER() OVER (PARTITION BY RPD.POLICY_NUMBER, RPD.POLICY_EFFECTIVE_DATE ORDER BY RPD.TRANS_DATE DESC) AS REC_CNT
FROM
(
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.POLICY_EFFECTIVE_DATE,
RPOL.POLICY_ISSUE_DATE,
RPOL.POLICY_TERMINATION_DATE,
RPOL.SUBMISSION_DATE,
RPOL.PCCY  AS CURRENCY,
RPOL.PSTU  AS POLICY_STATUS,
NULL  AS DIVIDEND_OPTION,
NULL  AS ACCUMULATED_DIVIDEND,
NULL  AS ACCUMULATED_DIV_INTRST,
NULL AS ADDITIONAL_PAID_UP_AMOUNT,
NULL  AS FACE_VAL_ON_RVRSNRY_BONUS,
NULL  AS FACE_VAL_ON_TRMNL_BONUS,
NULL AS BONUS_IN_FACE_VALUE_AMOUNT,
NULL AS ADDITIONAL_PAID_UP_FACE_VALUE,
NULL AS COUPON_AMOUNT,
NULL AS DATE_OF_COST_INS_UPD,
NULL AS LOAN_BALANCE,
NULL AS LOAN_BLNCE_INTEREST,
NULL AS DEATH_BNFT_OPTIONS,
NULL AS INDEXATION_STATE,
NULL AS POLICY_INDEXATION_TYPE,
NULL  AS COMMUNICATION_MEANS,
NULL AS SMS,
NULL AS SUS_SMS,
NULL AS SUS_EMAIL,
NULL  AS ESERVICE_INDICATOR,
NULL  AS MAE_OPTION_CODE,
NULL  AS COUPON_INTEREST,
NULL  AS REDUCED_PAID_UP,
NULL  AS PURE_ENDOWMENT,
NULL AS ETA_EXPIRY_DATE,
NULL AS ASSIGNEE_TYPE_CODE,
RPOL.GPLAN AS PLAN_CODE,
RPOL.PEXP AS EXPIRY_DATE,
NULL AS INITIAL_LS_PREMIUM,
NULL AS REGULAR_TOPUP_PREMIUM,
RPOL.GFPDB AS FUTURE_PREMIUM_DEPOSIT,
NULL AS MODAL_PREMIUM,
RPOL.GFPDI  AS FUTURE_PREM_DEPOSIT_INTEREST,
NULL AS PREMIUM_DUE_DATE,
NULL AS PREMIUM_HOLIDAY_START,
NULL AS PREMIUM_HOLIDAY_END,
RPOL.PMODE AS PAYMENT_MODE_CD,
RPOL.PMTHOD AS PAYMENT_METHOD,
RPOL.POWNER AS OWNER_LAST_NAME,
RPOL.OWNER_PARTY_TYP_CD,
CASE WHEN RPOL.POWNER IS NOT NULL OR RPOL.POWNID IS NOT NULL THEN (RPOL.PNO||':OWN') ELSE NULL END AS OWNER_PARTY_ID,
RPOL.POWNID AS OWNER_ID_DOC_NUMBER,
'SECURITYNO' AS ID_DOCUMENT_TYPE,
RPOL.PNAME AS INSRD_LAST_NAME,
RPOL.DATE_OF_BIRTH,
RPOL.PSEX AS GENDER,
RPOL.INSRD_PARTY_TYP_CD,
(RPOL.PNO||':INS') AS INSRD_PARTY_ID,
RPOL.PID AS INS_ID_DOCUMENT_NUMBER,
NULL AS ASSIGNEE_NAME,
NULL AS ASSIGNEE_TYPE,
CASE
	WHEN TRIM(RPOL.PPAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT1,-(LENGTH(PPAGT1)),(LENGTH(PPAGT1)-8))||'-'||SUBSTR(RPOL.PPAGT1,-8,2)||'-'||SUBSTR(RPOL.PPAGT1,-6)
END AS PRODUCING_AGENT_CD_1,
CASE
	WHEN TRIM(RPOL.PPAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT2,-(LENGTH(PPAGT2)),(LENGTH(PPAGT2)-8))||'-'||SUBSTR(RPOL.PPAGT2,-8,2)||'-'||SUBSTR(RPOL.PPAGT2,-6)
END AS PRODUCING_AGENT_CD_2,
CASE
	WHEN TRIM(RPOL.PAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT1,-(LENGTH(PAGT1)),(LENGTH(PAGT1)-8))||'-'||SUBSTR(RPOL.PAGT1,-8,2)||'-'||SUBSTR(RPOL.PAGT1,-6)
END AS SERVICING_AGENT_CD_1,
CASE
	WHEN TRIM(RPOL.PAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT2,-(LENGTH(PAGT2)),(LENGTH(PAGT2)-8))||'-'||SUBSTR(RPOL.PAGT2,-8,2)||'-'||SUBSTR(RPOL.PAGT2,-6)
END AS SERVICING_AGENT_CD_2,
RPOL.ACTUAL_SERVICING_AGENT,
NULL AS SUM_INSURED,
NULL AS TOTAL_SUM_INSURED,
NULL AS BASIC_SUM_INSURED,
RPOL.POLICY_TYPE,
RPOL.TOTAL_AMOUNT,
--RPOL.WITHDRAWAL_AMOUNT,
RPOL.PREMIUM_OVERDUE,
NULL AS PREMIUM_HOLIDAY_INDICATOR,
RPOL.REINSTATEMENT_EFF_DATE,
RPOL.EFF_POLICY_CHANGE_DATE,
RPOL.TRANS_DATE,
RPOL.ACTUAL_TERM_DATE,
RPOL.PMCOMM AS MODAL_COMMISSION,
RPOL.COMMISSION_RATE,
NULL AS PAID_TO_DATE,
NULL AS CLASS_CODE,
NULL AS CSC_CODE,
RPOL.PADR1 AS POLICY_ADDRESS_LINE_1,
RPOL.PADR2 AS POLICY_ADDRESS_LINE_2,
RPOL.PADR3 AS POLICY_ADDRESS_LINE_3,
RPOL.PADR4 AS POLICY_ADDRESS_LINE_4,
RPOL.E59PCCA1 AS CHINESE_POLICY_ADDRESS_LINE_1,
RPOL.E59PCCA2 AS CHINESE_POLICY_ADDRESS_LINE_2,
RPOL.E59PCCA3 AS CHINESE_POLICY_ADDRESS_LINE_3,
RPOL.E59PCCA4 AS CHINESE_POLICY_ADDRESS_LINE_4,
RPOL.ACTIVITY_SUSPENSION_FLG,			/* DATH-686 */
NULL AS EXCLUSION,
NULL AS TEMP_LOADING,
NULL AS NON_FORFEITURE_OPT,				/*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_1,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_2,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_3,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_4,                /*  DAPH-1192  */
NULL AS ASSIGNEE_CITY,                     /*  DAPH-1192  */
NULL AS EXP_DATE_OF_TEMP_LOADING,          /*  DAPH-1192  */
NULL AS MAINTENANCE_CD,                    /*  DAPH-1192  */
NULL AS SOURCE_CD,                          /*  DAPH-1192  */
NULL AS LILSP,		/*NBPT*/
NULL AS LBPRM,		/*NBPT*/
NULL AS PMPREM,		/*NBPT*/
NULL AS LPRL,		/*NBPT*/
RPOL.E59PCAA1 AS CHINESE_ASSIGNEE_ADDRESS_1,
RPOL.E59PCAA2 AS CHINESE_ASSIGNEE_ADDRESS_2,
RPOL.E59PCAA3 AS CHINESE_ASSIGNEE_ADDRESS_3,
RPOL.E59PCAA4 AS CHINESE_ASSIGNEE_ADDRESS_4,
RPOL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPOL.OWNER_GENDER, /* DASI ENHANCEMENT */
RPOL.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPOL.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
POL.PNO,
POL.POLICY_EFFECTIVE_DATE,
POL.POLICY_ISSUE_DATE,
POL.POLICY_TERMINATION_DATE,
POL.SUBMISSION_DATE,
POL.PCCY ,
POL.PSTU ,
POL.GPLAN,
POL.PEXP,
POL.GFPDB ,
POL.GFPDI ,
POL.PPTD,
POL.PMODE,
POL.PMTHOD,
POL.POWNER,
POL.OWNER_PARTY_TYP_CD,
POL.POWNID,
POL.PNAME,
POL.DATE_OF_BIRTH,
POL.PSEX,
POL.INSRD_PARTY_TYP_CD,
POL.PID,
POL.HOME_TELEPHONE ,
POL.OFFICE_TELEPHONE,
POL.HOME_TLPHN_ADDR_TYP_CD,
POL.MOB_TLPHN_ADDR_TYP_CD,
POL.OFF_TLPHN_ADDR_TYP_CD,
POL.ELCTRNC_ADDR_TYP_CD,
POL.POLICY_TYPE,
POL.PREMIUM_OVERDUE,
POL.REINSTATEMENT_EFF_DATE,
POL.EFF_POLICY_CHANGE_DATE,
POL.TRANS_DATE,
POL.TERMINATE_DATE,
POL.ACTUAL_TERM_DATE,
POL.PMCOMM,
POL.COMMISSION_RATE,
POL.PPAGT1,
POL.PPAGT2,
POL.PAGT1,
POL.PAGT2,
POL.ACTUAL_SERVICING_AGENT,
CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' THEN LFPODSAS.ASSURV
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) THEN LFPODSPS.PSTAMT
END TOTAL_AMOUNT,
/*CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' AND LFPUFTD.N9TCOD='AW' AND LFPUFTDH.M2TCOD='AW' THEN (LFPUFTD.N9AMTP + LFPUFTDH.M2AMTP)
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) AND (LFPACT.ACTCD LIKE 'AW%' OR LFPACTC.ACTCD LIKE 'AW%') THEN (NVL(LFPACT.ACAMT,0) + NVL(LFPACTC.ACAMT,0))
END AS WITHDRAWAL_AMOUNT,*/
POL.PADR1,
POL.PADR2,
POL.PADR3,
POL.PADR4,
POL.PMPREM,
LFPTCINF.E59PCCA1,
LFPTCINF.E59PCCA2,
LFPTCINF.E59PCCA3,
LFPTCINF.E59PCCA4,
POL.ACTIVITY_SUSPENSION_FLG, /* DATH-686 */
LFPTCINF.E59PCAA1,
LFPTCINF.E59PCAA2,
LFPTCINF.E59PCAA3,
LFPTCINF.E59PCAA4,
POL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL.OWNER_GENDER, /* DASI ENHANCEMENT */
POL.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(

SELECT
LFPPMG.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PEFF)),1,TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_EFFECTIVE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PDOI)),1,TO_DATE(TO_CHAR(LFPPMG.PDOI),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_ISSUE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PTERM)),1,TO_DATE(TO_CHAR(LFPPMG.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_TERMINATION_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PDOS)),1,TO_DATE(TO_CHAR(LFPPMG.PDOS),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS SUBMISSION_DATE,
LFPPMG.PCCY ,
LFPPMG.PSTU ,
LFPPMG.GPLAN,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PEXP)),1,TO_DATE(TO_CHAR(LFPPMG.PEXP),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PEXP,
LFPPMG.GFPDB ,
LFPPMG.GFPDI ,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PPTD)),1,TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PPTD,
LFPPMG.PMODE,
LFPPMG.PMTHOD,
LFPPMG.POWNER,
'OWN' AS OWNER_PARTY_TYP_CD,
LFPPMG.POWNID,
LFPPMG.PNAME,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PDOB)),1,TO_DATE(TO_CHAR(LFPPMG.PDOB),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS DATE_OF_BIRTH,
LFPPMG.PSEX,
'INS' AS INSRD_PARTY_TYP_CD,
LFPPMG.PID,
LFPPMG.PTEL1 AS HOME_TELEPHONE ,
LFPPMG.PTEL2 AS OFFICE_TELEPHONE,
'HOM' AS HOME_TLPHN_ADDR_TYP_CD,
'MOB' AS MOB_TLPHN_ADDR_TYP_CD,
'OFF' AS OFF_TLPHN_ADDR_TYP_CD,
'EML' AS ELCTRNC_ADDR_TYP_CD,
LFPPMG.PPAGT1,
LFPPMG.PPAGT2,
LFPPMG.PAGT1,
LFPPMG.PAGT2,
CASE
	WHEN SATB.LFASA IS NOT NULL THEN SUBSTR(LFASA,-(LENGTH(LFASA)),(LENGTH(LFASA)-8))||'-'||SUBSTR(LFASA,-8,2)||'-'||SUBSTR(LFASA,-6)
	ELSE NULL
END ACTUAL_SERVICING_AGENT,
CASE
	WHEN TBP.PLSBGP IN ('16','17') THEN 'TERM PLAN'
	WHEN TBP.PLSBGP IN ('11','12', '13') THEN 'WHOLE LIFE'
	WHEN TBP.PLSBGP IN ('14','15') THEN 'ENDOWMENT'
	WHEN TBP.PLSBGP IN ('33','34') THEN 'HEALTH/HOSPITAL'
	WHEN TBP.PLSBGP = '18' THEN 'UNIT LINK'
	ELSE 'TRADITIONAL'
END POLICY_TYPE,
CASE
	WHEN (DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PPTD)),1,TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD')) < TRUNC(SYSDATE) AND LFPPMG.PSTU NOT IN('2','3','4','7','8','9','A','C','D','E','Z')) THEN 'YES'
	ELSE 'NO'
END PREMIUM_OVERDUE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PREFF)),1,TO_DATE(TO_CHAR(LFPPMG.PREFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS REINSTATEMENT_EFF_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PTEFF)),1,TO_DATE(TO_CHAR(LFPPMG.PTEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS EFF_POLICY_CHANGE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PDOT)),1,TO_DATE(TO_CHAR(LFPPMG.PDOT),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TRANS_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PTERM)),1,TO_DATE(TO_CHAR(LFPPMG.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TERMINATE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PATERM)),1,TO_DATE(TO_CHAR(LFPPMG.PATERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS ACTUAL_TERM_DATE,
LFPPMG.PMCOMM,
CASE
  WHEN IS_DATE_DAPI(TO_CHAR(LFPPMG.PEFF))=0 THEN PAGTC11
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 1) OR (IS_DATE_DAPI(TO_CHAR(LFPPMG.PPTD))=0) THEN PAGTC1
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 2) THEN PAGTC2
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 3) THEN PAGTC3
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 4) THEN PAGTC4
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 5) THEN PAGTC5
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 6) THEN PAGTC6
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 7) THEN PAGTC7
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 8) THEN PAGTC8
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 9) THEN PAGTC9
	WHEN ((TO_DATE(TO_CHAR(LFPPMG.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYYMMDD'))/365 <= 10) THEN PAGTC10
	ELSE PAGTC11
END AS COMMISSION_RATE,
LFPPMG.PADR1,
LFPPMG.PADR2,
LFPPMG.PADR3,
LFPPMG.PADR4,
LFPPMG.PMPREM,
LFPPMG.PSUSF AS ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
NULL AS OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
LFPPMG.POWSEX AS OWNER_GENDER, /* DASI ENHANCEMENT */
LFPPMG.PMOMBNO AS OWNER_MOBILE, /* DASI ENHANCEMENT */
LFPPMG.PEMAL AS OWNER_EMAIL, /* DASI ENHANCEMENT */
CASE WHEN TRIM(LFPPMG.POWNER) IS NOT NULL THEN 'OWN' END AS PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
'INS' AS PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
MR_LFPPMG LFPPMG
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPMG.GPLAN = TBP.PLAN
LEFT OUTER JOIN MR_LFPASATB SATB
ON LFPPMG.PNO=SATB.LFPNO
WHERE LFPPMG.PNO = '%policyNumber%' /*POLICY NUMBER*/
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PEFF)),1,TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD'))>= TO_DATE('1900-01-01','YYYY-MM-DD') 	/* INPUT POLICY_EFFECTIVE_FROM_DATE */
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMG.PEFF)),1,TO_DATE(TO_CHAR(LFPPMG.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) <= TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD') 	/* INPUT POLICY_EFFECTIVE_TO_DATE */
)POL
LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
/*LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO*/
LEFT OUTER JOIN MR_LFPTCINF LFPTCINF
ON POL.PNO=LFPTCINF.E59PNO
)RPOL
)RPD
) POL_DETAILS
WHERE POL_DETAILS.REC_CNT = 1


UNION ALL

SELECT
POL_DETAILS.POLICY_NUMBER,
POL_DETAILS.POLICY_EFFECTIVE_DATE,
POL_DETAILS.POLICY_ISSUE_DATE,
POL_DETAILS.POLICY_TERMINATION_DATE,
POL_DETAILS.SUBMISSION_DATE,
POL_DETAILS.CURRENCY,
POL_DETAILS.POLICY_STATUS,
POL_DETAILS.DIVIDEND_OPTION,
POL_DETAILS.ACCUMULATED_DIVIDEND,
POL_DETAILS.ACCUMULATED_DIV_INTRST,
POL_DETAILS.ADDITIONAL_PAID_UP_AMOUNT,
POL_DETAILS.FACE_VAL_ON_RVRSNRY_BONUS,
POL_DETAILS.FACE_VAL_ON_TRMNL_BONUS,
POL_DETAILS.BONUS_IN_FACE_VALUE_AMOUNT,
POL_DETAILS.ADDITIONAL_PAID_UP_FACE_VALUE,
POL_DETAILS.COUPON_AMOUNT,
POL_DETAILS.DATE_OF_COST_INS_UPD,
POL_DETAILS.LOAN_BALANCE,
POL_DETAILS.LOAN_BLNCE_INTEREST,
POL_DETAILS.DEATH_BNFT_OPTIONS,
POL_DETAILS.INDEXATION_STATE,
POL_DETAILS.POLICY_INDEXATION_TYPE,
POL_DETAILS.COMMUNICATION_MEANS,
POL_DETAILS.SMS,
POL_DETAILS.SUS_SMS,
POL_DETAILS.SUS_EMAIL,
POL_DETAILS.ESERVICE_INDICATOR,
POL_DETAILS.MAE_OPTION_CODE,
POL_DETAILS.COUPON_INTEREST,
POL_DETAILS.REDUCED_PAID_UP,
POL_DETAILS.PURE_ENDOWMENT,
POL_DETAILS.ETA_EXPIRY_DATE,
POL_DETAILS.ASSIGNEE_TYPE_CODE,
POL_DETAILS.PLAN_CODE,
POL_DETAILS.EXPIRY_DATE,
POL_DETAILS.INITIAL_LS_PREMIUM,
POL_DETAILS.REGULAR_TOPUP_PREMIUM,
POL_DETAILS.FUTURE_PREMIUM_DEPOSIT,
POL_DETAILS.MODAL_PREMIUM,
POL_DETAILS.FUTURE_PREM_DEPOSIT_INTEREST,
POL_DETAILS.PREMIUM_DUE_DATE,
POL_DETAILS.PREMIUM_HOLIDAY_START,
POL_DETAILS.PREMIUM_HOLIDAY_END,
POL_DETAILS.PAYMENT_MODE_CD,
POL_DETAILS.PAYMENT_METHOD,
POL_DETAILS.OWNER_LAST_NAME,
POL_DETAILS.OWNER_PARTY_TYP_CD,
POL_DETAILS.OWNER_PARTY_ID,
POL_DETAILS.OWNER_ID_DOC_NUMBER,
POL_DETAILS.ID_DOCUMENT_TYPE,
POL_DETAILS.INSRD_LAST_NAME,
POL_DETAILS.DATE_OF_BIRTH,
POL_DETAILS.GENDER,
POL_DETAILS.INSRD_PARTY_TYP_CD,
POL_DETAILS.INSRD_PARTY_ID,
POL_DETAILS.INS_ID_DOCUMENT_NUMBER,
POL_DETAILS.ASSIGNEE_NAME,
POL_DETAILS.ASSIGNEE_TYPE,
POL_DETAILS.PRODUCING_AGENT_CD_1,
POL_DETAILS.PRODUCING_AGENT_CD_2,
POL_DETAILS.SERVICING_AGENT_CD_1,
POL_DETAILS.SERVICING_AGENT_CD_2,
POL_DETAILS.SUM_INSURED,
POL_DETAILS.TOTAL_SUM_INSURED,
POL_DETAILS.BASIC_SUM_INSURED,
POL_DETAILS.POLICY_TYPE,
POL_DETAILS.TOTAL_AMOUNT,
--POL_DETAILS.WITHDRAWAL_AMOUNT,
POL_DETAILS.PREMIUM_OVERDUE,
POL_DETAILS.PREMIUM_HOLIDAY_INDICATOR,
POL_DETAILS.REINSTATEMENT_EFF_DATE,
POL_DETAILS.EFF_POLICY_CHANGE_DATE,
POL_DETAILS.TRANS_DATE,
POL_DETAILS.ACTUAL_TERM_DATE,
POL_DETAILS.MODAL_COMMISSION,
POL_DETAILS.COMMISSION_RATE,
POL_DETAILS.PAID_TO_DATE,
POL_DETAILS.CLASS_CODE,
POL_DETAILS.CSC_CODE,
POL_DETAILS.POLICY_ADDRESS_LINE_1,
POL_DETAILS.POLICY_ADDRESS_LINE_2,
POL_DETAILS.POLICY_ADDRESS_LINE_3,
POL_DETAILS.POLICY_ADDRESS_LINE_4,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_1,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_2,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_3,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_4,
POL_DETAILS.ACTIVITY_SUSPENSION_FLG	,		/* DATH-686 */
POL_DETAILS.EXCLUSION, /*DAHK-573*/
POL_DETAILS.TEMP_LOADING, /*DAHK-573*/
POL_DETAILS.ACTUAL_SERVICING_AGENT /*DAHK-1853*/,
POL_DETAILS.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_1,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_CITY,                  /*  DAPH-1192  */
POL_DETAILS.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
POL_DETAILS.MAINTENANCE_CD,                 /*  DAPH-1192  */
POL_DETAILS.SOURCE_CD,                       /*  DAPH-1192  */
POL_DETAILS.LILSP,		/*NBPT*/
POL_DETAILS.LBPRM,		/*NBPT*/
POL_DETAILS.PMPREM,		/*NBPT*/
POL_DETAILS.LPRL,		/*NBPT*/
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_1,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_2,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_3,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_4,
POL_DETAILS.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_GENDER, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
RPD.POLICY_NUMBER,
RPD.POLICY_EFFECTIVE_DATE,
RPD.POLICY_ISSUE_DATE,
RPD.POLICY_TERMINATION_DATE,
RPD.SUBMISSION_DATE,
RPD.CURRENCY,
RPD.POLICY_STATUS,
RPD.DIVIDEND_OPTION,
RPD.ACCUMULATED_DIVIDEND,
RPD.ACCUMULATED_DIV_INTRST,
RPD.ADDITIONAL_PAID_UP_AMOUNT,
RPD.FACE_VAL_ON_RVRSNRY_BONUS,
RPD.FACE_VAL_ON_TRMNL_BONUS,
RPD.BONUS_IN_FACE_VALUE_AMOUNT,
RPD.ADDITIONAL_PAID_UP_FACE_VALUE,
RPD.COUPON_AMOUNT,
RPD.DATE_OF_COST_INS_UPD,
RPD.LOAN_BALANCE,
RPD.LOAN_BLNCE_INTEREST,
RPD.DEATH_BNFT_OPTIONS,
RPD.INDEXATION_STATE,
RPD.POLICY_INDEXATION_TYPE,
RPD.COMMUNICATION_MEANS,
RPD.SMS,
RPD.SUS_SMS,
RPD.SUS_EMAIL,
RPD.ESERVICE_INDICATOR,
RPD.MAE_OPTION_CODE,
RPD.COUPON_INTEREST,
RPD.REDUCED_PAID_UP,
RPD.PURE_ENDOWMENT,
RPD.ETA_EXPIRY_DATE,
RPD.ASSIGNEE_TYPE_CODE,
RPD.PLAN_CODE,
RPD.EXPIRY_DATE,
RPD.INITIAL_LS_PREMIUM,
RPD.REGULAR_TOPUP_PREMIUM,
RPD.FUTURE_PREMIUM_DEPOSIT,
RPD.MODAL_PREMIUM,
RPD.FUTURE_PREM_DEPOSIT_INTEREST,
RPD.PREMIUM_DUE_DATE,
RPD.PREMIUM_HOLIDAY_START,
RPD.PREMIUM_HOLIDAY_END,
RPD.PAYMENT_MODE_CD,
RPD.PAYMENT_METHOD,
RPD.OWNER_LAST_NAME,
RPD.OWNER_PARTY_TYP_CD,
RPD.OWNER_PARTY_ID,
RPD.OWNER_ID_DOC_NUMBER,
RPD.ID_DOCUMENT_TYPE,
RPD.INSRD_LAST_NAME,
RPD.DATE_OF_BIRTH,
RPD.GENDER,
RPD.INSRD_PARTY_TYP_CD,
RPD.INSRD_PARTY_ID,
RPD.INS_ID_DOCUMENT_NUMBER,
RPD.ASSIGNEE_NAME,
RPD.ASSIGNEE_TYPE,
RPD.PRODUCING_AGENT_CD_1,
RPD.PRODUCING_AGENT_CD_2,
RPD.SERVICING_AGENT_CD_1,
RPD.SERVICING_AGENT_CD_2,
RPD.ACTUAL_SERVICING_AGENT,
RPD.SUM_INSURED,
RPD.TOTAL_SUM_INSURED,
RPD.BASIC_SUM_INSURED,
RPD.POLICY_TYPE,
RPD.TOTAL_AMOUNT,
--RPD.WITHDRAWAL_AMOUNT,
RPD.PREMIUM_OVERDUE,
RPD.PREMIUM_HOLIDAY_INDICATOR,
RPD.REINSTATEMENT_EFF_DATE,
RPD.EFF_POLICY_CHANGE_DATE,
RPD.TRANS_DATE,
RPD.ACTUAL_TERM_DATE,
RPD.MODAL_COMMISSION,
RPD.COMMISSION_RATE,
RPD.PAID_TO_DATE,
RPD.CLASS_CODE,
RPD.CSC_CODE,
RPD.POLICY_ADDRESS_LINE_1,
RPD.POLICY_ADDRESS_LINE_2,
RPD.POLICY_ADDRESS_LINE_3,
RPD.POLICY_ADDRESS_LINE_4,
RPD.CHINESE_POLICY_ADDRESS_LINE_1,
RPD.CHINESE_POLICY_ADDRESS_LINE_2,
RPD.CHINESE_POLICY_ADDRESS_LINE_3,
RPD.CHINESE_POLICY_ADDRESS_LINE_4,
RPD.ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
RPD.EXCLUSION,
RPD.TEMP_LOADING,
RPD.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_1,			    /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
RPD.ASSIGNEE_CITY,                  /*  DAPH-1192  */
RPD.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
RPD.MAINTENANCE_CD,                 /*  DAPH-1192  */
RPD.SOURCE_CD,						/*  DAPH-1192  */
RPD.LILSP,		/*NBPT*/
RPD.LBPRM,		/*NBPT*/
RPD.PMPREM,		/*NBPT*/
RPD.LPRL,		/*NBPT*/
RPD.CHINESE_ASSIGNEE_ADDRESS_1,
RPD.CHINESE_ASSIGNEE_ADDRESS_2,
RPD.CHINESE_ASSIGNEE_ADDRESS_3,
RPD.CHINESE_ASSIGNEE_ADDRESS_4,
RPD.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPD.OWNER_GENDER, /* DASI ENHANCEMENT */
RPD.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPD.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_INS, /* DASI ENHANCEMENT */
ROW_NUMBER() OVER (PARTITION BY RPD.POLICY_NUMBER, RPD.POLICY_EFFECTIVE_DATE ORDER BY RPD.TRANS_DATE DESC) AS REC_CNT
FROM
(
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.POLICY_EFFECTIVE_DATE,
RPOL.POLICY_ISSUE_DATE,
RPOL.POLICY_TERMINATION_DATE,
RPOL.SUBMISSION_DATE,
RPOL.PCCY  AS CURRENCY,
RPOL.PSTU  AS POLICY_STATUS,
NULL  AS DIVIDEND_OPTION,
NULL  AS ACCUMULATED_DIVIDEND,
NULL  AS ACCUMULATED_DIV_INTRST,
NULL AS ADDITIONAL_PAID_UP_AMOUNT,
NULL  AS FACE_VAL_ON_RVRSNRY_BONUS,
NULL  AS FACE_VAL_ON_TRMNL_BONUS,
NULL AS BONUS_IN_FACE_VALUE_AMOUNT,
NULL AS ADDITIONAL_PAID_UP_FACE_VALUE,
NULL AS COUPON_AMOUNT,
NULL AS DATE_OF_COST_INS_UPD,
NULL AS LOAN_BALANCE,
NULL AS LOAN_BLNCE_INTEREST,
NULL AS DEATH_BNFT_OPTIONS,
NULL AS INDEXATION_STATE,
NULL AS POLICY_INDEXATION_TYPE,
NULL  AS COMMUNICATION_MEANS,
NULL AS SMS,
NULL AS SUS_SMS,
NULL AS SUS_EMAIL,
NULL  AS ESERVICE_INDICATOR,
NULL  AS MAE_OPTION_CODE,
NULL  AS COUPON_INTEREST,
NULL  AS REDUCED_PAID_UP,
NULL  AS PURE_ENDOWMENT,
NULL AS ETA_EXPIRY_DATE,
NULL AS ASSIGNEE_TYPE_CODE,
RPOL.DPLAN AS PLAN_CODE,
RPOL.PEXP AS EXPIRY_DATE,
NULL AS INITIAL_LS_PREMIUM,
NULL AS REGULAR_TOPUP_PREMIUM,
RPOL.DFPDB AS FUTURE_PREMIUM_DEPOSIT,
NULL AS MODAL_PREMIUM,
RPOL.DFPDI  AS FUTURE_PREM_DEPOSIT_INTEREST,
NULL AS PREMIUM_DUE_DATE,
NULL AS PREMIUM_HOLIDAY_START,
NULL AS PREMIUM_HOLIDAY_END,
RPOL.PMODE AS PAYMENT_MODE_CD,
RPOL.PMTHOD AS PAYMENT_METHOD,
RPOL.POWNER AS OWNER_LAST_NAME,
RPOL.OWNER_PARTY_TYP_CD,
CASE WHEN RPOL.POWNER IS NOT NULL OR RPOL.POWNID IS NOT NULL THEN (RPOL.PNO||':OWN') ELSE NULL END AS OWNER_PARTY_ID,
RPOL.POWNID AS OWNER_ID_DOC_NUMBER,
'SECURITYNO' AS ID_DOCUMENT_TYPE,
RPOL.PNAME AS INSRD_LAST_NAME,
RPOL.DATE_OF_BIRTH,
RPOL.PSEX AS GENDER,
RPOL.INSRD_PARTY_TYP_CD,
(RPOL.PNO||':INS') AS INSRD_PARTY_ID,
RPOL.PID AS INS_ID_DOCUMENT_NUMBER,
RPOL.DASSGN AS ASSIGNEE_NAME,
RPOL.DASNCD AS ASSIGNEE_TYPE,
CASE
	WHEN TRIM(RPOL.PPAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT1,-(LENGTH(PPAGT1)),(LENGTH(PPAGT1)-8))||'-'||SUBSTR(RPOL.PPAGT1,-8,2)||'-'||SUBSTR(RPOL.PPAGT1,-6)
END AS PRODUCING_AGENT_CD_1,
CASE
	WHEN TRIM(RPOL.PPAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT2,-(LENGTH(PPAGT2)),(LENGTH(PPAGT2)-8))||'-'||SUBSTR(RPOL.PPAGT2,-8,2)||'-'||SUBSTR(RPOL.PPAGT2,-6)
END AS PRODUCING_AGENT_CD_2,
CASE
	WHEN TRIM(RPOL.PAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT1,-(LENGTH(PAGT1)),(LENGTH(PAGT1)-8))||'-'||SUBSTR(RPOL.PAGT1,-8,2)||'-'||SUBSTR(RPOL.PAGT1,-6)
END AS SERVICING_AGENT_CD_1,
CASE
	WHEN TRIM(RPOL.PAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT2,-(LENGTH(PAGT2)),(LENGTH(PAGT2)-8))||'-'||SUBSTR(RPOL.PAGT2,-8,2)||'-'||SUBSTR(RPOL.PAGT2,-6)
END AS SERVICING_AGENT_CD_2,
RPOL.ACTUAL_SERVICING_AGENT,
NULL AS SUM_INSURED,
NULL AS TOTAL_SUM_INSURED,
NULL AS BASIC_SUM_INSURED,
RPOL.POLICY_TYPE,
RPOL.TOTAL_AMOUNT,
--RPOL.WITHDRAWAL_AMOUNT,
RPOL.PREMIUM_OVERDUE,
NULL AS PREMIUM_HOLIDAY_INDICATOR,
RPOL.REINSTATEMENT_EFF_DATE,
RPOL.EFF_POLICY_CHANGE_DATE,
RPOL.TRANS_DATE,
RPOL.ACTUAL_TERM_DATE,
RPOL.PMCOMM AS MODAL_COMMISSION,
RPOL.COMMISSION_RATE,
NULL AS PAID_TO_DATE,
RPOL.DCLS AS CLASS_CODE,
NULL AS CSC_CODE,
RPOL.PADR1 AS POLICY_ADDRESS_LINE_1,
RPOL.PADR2 AS POLICY_ADDRESS_LINE_2,
RPOL.PADR3 AS POLICY_ADDRESS_LINE_3,
RPOL.PADR4 AS POLICY_ADDRESS_LINE_4,
RPOL.E59PCCA1 AS CHINESE_POLICY_ADDRESS_LINE_1,
RPOL.E59PCCA2 AS CHINESE_POLICY_ADDRESS_LINE_2,
RPOL.E59PCCA3 AS CHINESE_POLICY_ADDRESS_LINE_3,
RPOL.E59PCCA4 AS CHINESE_POLICY_ADDRESS_LINE_4,
RPOL.ACTIVITY_SUSPENSION_FLG,			/* DATH-686 */
RPOL.DEXCL AS EXCLUSION,
NULL AS TEMP_LOADING,
NULL AS NON_FORFEITURE_OPT,				/*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_1,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_2,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_3,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_4,                /*  DAPH-1192  */
NULL AS ASSIGNEE_CITY,                     /*  DAPH-1192  */
NULL AS EXP_DATE_OF_TEMP_LOADING,          /*  DAPH-1192  */
NULL AS MAINTENANCE_CD,                    /*  DAPH-1192  */
NULL AS SOURCE_CD,                          /*  DAPH-1192  */
NULL AS LILSP,		/*NBPT*/
NULL AS LBPRM,		/*NBPT*/
NULL AS PMPREM,		/*NBPT*/
NULL AS LPRL,		/*NBPT*/
RPOL.E59PCAA1 AS CHINESE_ASSIGNEE_ADDRESS_1,
RPOL.E59PCAA2 AS CHINESE_ASSIGNEE_ADDRESS_2,
RPOL.E59PCAA3 AS CHINESE_ASSIGNEE_ADDRESS_3,
RPOL.E59PCAA4 AS CHINESE_ASSIGNEE_ADDRESS_4,
RPOL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPOL.OWNER_GENDER, /* DASI ENHANCEMENT */
RPOL.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPOL.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
POL.PNO,
POL.POLICY_EFFECTIVE_DATE,
POL.POLICY_ISSUE_DATE,
POL.POLICY_TERMINATION_DATE,
POL.SUBMISSION_DATE,
POL.PCCY ,
POL.PSTU ,
POL.DPLAN,
POL.PEXP,
POL.DFPDB ,
POL.DFPDI ,
POL.PPTD,
POL.PMODE,
POL.PMTHOD,
POL.POWNER,
POL.OWNER_PARTY_TYP_CD,
POL.POWNID,
POL.PNAME,
POL.DATE_OF_BIRTH,
POL.PSEX,
POL.INSRD_PARTY_TYP_CD,
POL.PID,
POL.HOME_TELEPHONE ,
POL.OFFICE_TELEPHONE,
POL.DASSGN,
POL.DASNCD,
POL.HOME_TLPHN_ADDR_TYP_CD,
POL.MOB_TLPHN_ADDR_TYP_CD,
POL.OFF_TLPHN_ADDR_TYP_CD,
POL.ELCTRNC_ADDR_TYP_CD,
POL.POLICY_TYPE,
POL.PREMIUM_OVERDUE,
POL.REINSTATEMENT_EFF_DATE,
POL.EFF_POLICY_CHANGE_DATE,
POL.TRANS_DATE,
POL.TERMINATE_DATE,
POL.ACTUAL_TERM_DATE,
POL.PMCOMM,
POL.DCLS,
POL.COMMISSION_RATE,
POL.PPAGT1,
POL.PPAGT2,
POL.PAGT1,
POL.PAGT2,
POL.ACTUAL_SERVICING_AGENT,
CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' THEN LFPODSAS.ASSURV
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) THEN LFPODSPS.PSTAMT
END TOTAL_AMOUNT,
/*CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' AND LFPUFTD.N9TCOD='AW' AND LFPUFTDH.M2TCOD='AW' THEN (LFPUFTD.N9AMTP + LFPUFTDH.M2AMTP)
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) AND (LFPACT.ACTCD LIKE 'AW%' OR LFPACTC.ACTCD LIKE 'AW%') THEN (NVL(LFPACT.ACAMT,0) + NVL(LFPACTC.ACAMT,0))
END AS WITHDRAWAL_AMOUNT,*/
POL.PADR1,
POL.PADR2,
POL.PADR3,
POL.PADR4,
POL.PMPREM,
LFPTCINF.E59PCCA1,
LFPTCINF.E59PCCA2,
LFPTCINF.E59PCCA3,
LFPTCINF.E59PCCA4,
POL.ACTIVITY_SUSPENSION_FLG	,		/* DATH-686 */
POL.DEXCL,
LFPTCINF.E59PCAA1,
LFPTCINF.E59PCAA2,
LFPTCINF.E59PCAA3,
LFPTCINF.E59PCAA4,
POL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL.OWNER_GENDER, /* DASI ENHANCEMENT */
POL.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(

SELECT
LFPPMD.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PEFF)),1,TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_EFFECTIVE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PDOI)),1,TO_DATE(TO_CHAR(LFPPMD.PDOI),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_ISSUE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PTERM)),1,TO_DATE(TO_CHAR(LFPPMD.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS POLICY_TERMINATION_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PDOS)),1,TO_DATE(TO_CHAR(LFPPMD.PDOS),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS SUBMISSION_DATE,
LFPPMD.PCCY ,
LFPPMD.PSTU ,
LFPPMD.DPLAN,
LFPPMD.DCLS,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PEXP)),1,TO_DATE(TO_CHAR(LFPPMD.PEXP),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PEXP,
LFPPMD.DFPDB ,
LFPPMD.DFPDI ,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PPTD)),1,TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PPTD,
LFPPMD.PMODE,
LFPPMD.PMTHOD,
LFPPMD.POWNER,
'OWN' AS OWNER_PARTY_TYP_CD,
LFPPMD.POWNID,
LFPPMD.PNAME,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PDOB)),1,TO_DATE(TO_CHAR(LFPPMD.PDOB),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS DATE_OF_BIRTH,
LFPPMD.PSEX,
'INS' AS INSRD_PARTY_TYP_CD,
LFPPMD.PID,
LFPPMD.PTEL1 AS HOME_TELEPHONE ,
LFPPMD.PTEL2 AS OFFICE_TELEPHONE,
LFPPMD.DASSGN,
LFPPMD.DASNCD,
'HOM' AS HOME_TLPHN_ADDR_TYP_CD,
'MOB' AS MOB_TLPHN_ADDR_TYP_CD,
'OFF' AS OFF_TLPHN_ADDR_TYP_CD,
'EML' AS ELCTRNC_ADDR_TYP_CD,
LFPPMD.PPAGT1,
LFPPMD.PPAGT2,
LFPPMD.PAGT1,
LFPPMD.PAGT2,
CASE
	WHEN SATB.LFASA IS NOT NULL THEN SUBSTR(LFASA,-(LENGTH(LFASA)),(LENGTH(LFASA)-8))||'-'||SUBSTR(LFASA,-8,2)||'-'||SUBSTR(LFASA,-6)
	ELSE NULL
END ACTUAL_SERVICING_AGENT,
CASE
	WHEN TBP.PLSBGP IN ('16','17') THEN 'TERM PLAN'
	WHEN TBP.PLSBGP IN ('11','12', '13') THEN 'WHOLE LIFE'
	WHEN TBP.PLSBGP IN ('14','15') THEN 'ENDOWMENT'
	WHEN TBP.PLSBGP IN ('33','34') THEN 'HEALTH/HOSPITAL'
	WHEN TBP.PLSBGP = '18' THEN 'UNIT LINK'
	ELSE 'TRADITIONAL'
END POLICY_TYPE,
CASE
	WHEN (DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PPTD)),1,TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD')) < TRUNC(SYSDATE) AND LFPPMD.PSTU NOT IN('2','3','4','7','8','9','A','C','D','E','Z')) THEN 'YES'
	ELSE 'NO'
END PREMIUM_OVERDUE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PREFF)),1,TO_DATE(TO_CHAR(LFPPMD.PREFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS REINSTATEMENT_EFF_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PTEFF)),1,TO_DATE(TO_CHAR(LFPPMD.PTEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS EFF_POLICY_CHANGE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PDOT)),1,TO_DATE(TO_CHAR(LFPPMD.PDOT),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TRANS_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PTERM)),1,TO_DATE(TO_CHAR(LFPPMD.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TERMINATE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PATERM)),1,TO_DATE(TO_CHAR(LFPPMD.PATERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS ACTUAL_TERM_DATE,
LFPPMD.PMCOMM,
CASE
  WHEN IS_DATE_DAPI(TO_CHAR(LFPPMD.PEFF))=0 THEN PAGTC11
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 1) OR (IS_DATE_DAPI(TO_CHAR(LFPPMD.PPTD))=0) THEN PAGTC1
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 2) THEN PAGTC2
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 3) THEN PAGTC3
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 4) THEN PAGTC4
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 5) THEN PAGTC5
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 6) THEN PAGTC6
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 7) THEN PAGTC7
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 8) THEN PAGTC8
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 9) THEN PAGTC9
	WHEN ((TO_DATE(TO_CHAR(LFPPMD.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYYMMDD'))/365 <= 10) THEN PAGTC10
	ELSE PAGTC11
END AS COMMISSION_RATE,
LFPPMD.PADR1,
LFPPMD.PADR2,
LFPPMD.PADR3,
LFPPMD.PADR4,
LFPPMD.PMPREM,
LFPPMD.PSUSF AS ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
LFPPMD.DEXCL,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.DPAYDB)),1,TO_DATE(TO_CHAR(LFPPMD.DPAYDB),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
LFPPMD.POWSEX AS OWNER_GENDER, /* DASI ENHANCEMENT */
LFPPMD.PMOMBNO AS OWNER_MOBILE, /* DASI ENHANCEMENT */
LFPPMD.PEMAL AS OWNER_EMAIL, /* DASI ENHANCEMENT */
CASE WHEN TRIM(LFPPMD.POWNER) IS NOT NULL THEN 'OWN' END AS PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
'INS' AS PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
MR_LFPPMD LFPPMD
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPMD.DPLAN = TBP.PLAN
LEFT OUTER JOIN MR_LFPASATB SATB
ON LFPPMD.PNO=SATB.LFPNO
WHERE LFPPMD.PNO = '%policyNumber%' /*POLICY NUMBER*/
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PEFF)),1,TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD'))>= TO_DATE('1900-01-01','YYYY-MM-DD') 	/* INPUT POLICY EFFECTIVE FROM DATE */
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMD.PEFF)),1,TO_DATE(TO_CHAR(LFPPMD.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) <= TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD') 	/* INPUT POLICY_EFFECTIVE_TO_DATE */
)POL
LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
/*LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO*/
LEFT OUTER JOIN MR_LFPTCINF LFPTCINF
ON POL.PNO=LFPTCINF.E59PNO
)RPOL
)RPD
) POL_DETAILS
WHERE POL_DETAILS.REC_CNT = 1


UNION ALL

SELECT
POL_DETAILS.POLICY_NUMBER,
POL_DETAILS.POLICY_EFFECTIVE_DATE,
POL_DETAILS.POLICY_ISSUE_DATE,
POL_DETAILS.POLICY_TERMINATION_DATE,
POL_DETAILS.SUBMISSION_DATE,
POL_DETAILS.CURRENCY,
POL_DETAILS.POLICY_STATUS,
POL_DETAILS.DIVIDEND_OPTION,
POL_DETAILS.ACCUMULATED_DIVIDEND,
POL_DETAILS.ACCUMULATED_DIV_INTRST,
POL_DETAILS.ADDITIONAL_PAID_UP_AMOUNT,
POL_DETAILS.FACE_VAL_ON_RVRSNRY_BONUS,
POL_DETAILS.FACE_VAL_ON_TRMNL_BONUS,
POL_DETAILS.BONUS_IN_FACE_VALUE_AMOUNT,
POL_DETAILS.ADDITIONAL_PAID_UP_FACE_VALUE,
POL_DETAILS.COUPON_AMOUNT,
POL_DETAILS.DATE_OF_COST_INS_UPD,
POL_DETAILS.LOAN_BALANCE,
POL_DETAILS.LOAN_BLNCE_INTEREST,
POL_DETAILS.DEATH_BNFT_OPTIONS,
POL_DETAILS.INDEXATION_STATE,
POL_DETAILS.POLICY_INDEXATION_TYPE,
POL_DETAILS.COMMUNICATION_MEANS,
POL_DETAILS.SMS,
POL_DETAILS.SUS_SMS,
POL_DETAILS.SUS_EMAIL,
POL_DETAILS.ESERVICE_INDICATOR,
POL_DETAILS.MAE_OPTION_CODE,
POL_DETAILS.COUPON_INTEREST,
POL_DETAILS.REDUCED_PAID_UP,
POL_DETAILS.PURE_ENDOWMENT,
POL_DETAILS.ETA_EXPIRY_DATE,
POL_DETAILS.ASSIGNEE_TYPE_CODE,
POL_DETAILS.PLAN_CODE,
POL_DETAILS.EXPIRY_DATE,
POL_DETAILS.INITIAL_LS_PREMIUM,
POL_DETAILS.REGULAR_TOPUP_PREMIUM,
POL_DETAILS.FUTURE_PREMIUM_DEPOSIT,
POL_DETAILS.MODAL_PREMIUM,
POL_DETAILS.FUTURE_PREM_DEPOSIT_INTEREST,
POL_DETAILS.PREMIUM_DUE_DATE,
POL_DETAILS.PREMIUM_HOLIDAY_START,
POL_DETAILS.PREMIUM_HOLIDAY_END,
POL_DETAILS.PAYMENT_MODE_CD,
POL_DETAILS.PAYMENT_METHOD,
POL_DETAILS.OWNER_LAST_NAME,
POL_DETAILS.OWNER_PARTY_TYP_CD,
POL_DETAILS.OWNER_PARTY_ID,
POL_DETAILS.OWNER_ID_DOC_NUMBER,
POL_DETAILS.ID_DOCUMENT_TYPE,
POL_DETAILS.INSRD_LAST_NAME,
POL_DETAILS.DATE_OF_BIRTH,
POL_DETAILS.GENDER,
POL_DETAILS.INSRD_PARTY_TYP_CD,
POL_DETAILS.INSRD_PARTY_ID,
POL_DETAILS.INS_ID_DOCUMENT_NUMBER,
POL_DETAILS.ASSIGNEE_NAME,
POL_DETAILS.ASSIGNEE_TYPE,
POL_DETAILS.PRODUCING_AGENT_CD_1,
POL_DETAILS.PRODUCING_AGENT_CD_2,
POL_DETAILS.SERVICING_AGENT_CD_1,
POL_DETAILS.SERVICING_AGENT_CD_2,
POL_DETAILS.SUM_INSURED,
POL_DETAILS.TOTAL_SUM_INSURED,
POL_DETAILS.BASIC_SUM_INSURED,
POL_DETAILS.POLICY_TYPE,
POL_DETAILS.TOTAL_AMOUNT,
--POL_DETAILS.WITHDRAWAL_AMOUNT,
POL_DETAILS.PREMIUM_OVERDUE,
POL_DETAILS.PREMIUM_HOLIDAY_INDICATOR,
POL_DETAILS.REINSTATEMENT_EFF_DATE,
POL_DETAILS.EFF_POLICY_CHANGE_DATE,
POL_DETAILS.TRANS_DATE,
POL_DETAILS.ACTUAL_TERM_DATE,
POL_DETAILS.MODAL_COMMISSION,
POL_DETAILS.COMMISSION_RATE,
POL_DETAILS.PAID_TO_DATE,
POL_DETAILS.CLASS_CODE,
POL_DETAILS.CSC_CODE,
POL_DETAILS.POLICY_ADDRESS_LINE_1,
POL_DETAILS.POLICY_ADDRESS_LINE_2,
POL_DETAILS.POLICY_ADDRESS_LINE_3,
POL_DETAILS.POLICY_ADDRESS_LINE_4,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_1,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_2,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_3,
POL_DETAILS.CHINESE_POLICY_ADDRESS_LINE_4,
POL_DETAILS.ACTIVITY_SUSPENSION_FLG	,		/* DATH-686 */
POL_DETAILS.EXCLUSION, /*DAHK-573*/
POL_DETAILS.TEMP_LOADING, /*DAHK-573*/
POL_DETAILS.ACTUAL_SERVICING_AGENT /*DAHK-1853*/,
POL_DETAILS.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_1,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
POL_DETAILS.ASSIGNEE_CITY,                  /*  DAPH-1192  */
POL_DETAILS.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
POL_DETAILS.MAINTENANCE_CD,                 /*  DAPH-1192  */
POL_DETAILS.SOURCE_CD,                       /*  DAPH-1192  */
POL_DETAILS.LILSP,		/*NBPT*/
POL_DETAILS.LBPRM,		/*NBPT*/
POL_DETAILS.PMPREM,		/*NBPT*/
POL_DETAILS.LPRL,		/*NBPT*/
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_1,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_2,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_3,
POL_DETAILS.CHINESE_ASSIGNEE_ADDRESS_4,
POL_DETAILS.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_GENDER, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL_DETAILS.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL_DETAILS.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
RPD.POLICY_NUMBER,
RPD.POLICY_EFFECTIVE_DATE,
RPD.POLICY_ISSUE_DATE,
RPD.POLICY_TERMINATION_DATE,
RPD.SUBMISSION_DATE,
RPD.CURRENCY,
RPD.POLICY_STATUS,
RPD.DIVIDEND_OPTION,
RPD.ACCUMULATED_DIVIDEND,
RPD.ACCUMULATED_DIV_INTRST,
RPD.ADDITIONAL_PAID_UP_AMOUNT,
RPD.FACE_VAL_ON_RVRSNRY_BONUS,
RPD.FACE_VAL_ON_TRMNL_BONUS,
RPD.BONUS_IN_FACE_VALUE_AMOUNT,
RPD.ADDITIONAL_PAID_UP_FACE_VALUE,
RPD.COUPON_AMOUNT,
RPD.DATE_OF_COST_INS_UPD,
RPD.LOAN_BALANCE,
RPD.LOAN_BLNCE_INTEREST,
RPD.DEATH_BNFT_OPTIONS,
RPD.INDEXATION_STATE,
RPD.POLICY_INDEXATION_TYPE,
RPD.COMMUNICATION_MEANS,
RPD.SMS,
RPD.SUS_SMS,
RPD.SUS_EMAIL,
RPD.ESERVICE_INDICATOR,
RPD.MAE_OPTION_CODE,
RPD.COUPON_INTEREST,
RPD.REDUCED_PAID_UP,
RPD.PURE_ENDOWMENT,
RPD.ETA_EXPIRY_DATE,
RPD.ASSIGNEE_TYPE_CODE,
RPD.PLAN_CODE,
RPD.EXPIRY_DATE,
RPD.INITIAL_LS_PREMIUM,
RPD.REGULAR_TOPUP_PREMIUM,
RPD.FUTURE_PREMIUM_DEPOSIT,
RPD.MODAL_PREMIUM,
RPD.FUTURE_PREM_DEPOSIT_INTEREST,
RPD.PREMIUM_DUE_DATE,
RPD.PREMIUM_HOLIDAY_START,
RPD.PREMIUM_HOLIDAY_END,
RPD.PAYMENT_MODE_CD,
RPD.PAYMENT_METHOD,
RPD.OWNER_LAST_NAME,
RPD.OWNER_PARTY_TYP_CD,
RPD.OWNER_PARTY_ID,
RPD.OWNER_ID_DOC_NUMBER,
RPD.ID_DOCUMENT_TYPE,
RPD.INSRD_LAST_NAME,
RPD.DATE_OF_BIRTH,
RPD.GENDER,
RPD.INSRD_PARTY_TYP_CD,
RPD.INSRD_PARTY_ID,
RPD.INS_ID_DOCUMENT_NUMBER,
RPD.ASSIGNEE_NAME,
RPD.ASSIGNEE_TYPE,
RPD.PRODUCING_AGENT_CD_1,
RPD.PRODUCING_AGENT_CD_2,
RPD.SERVICING_AGENT_CD_1,
RPD.SERVICING_AGENT_CD_2,
RPD.ACTUAL_SERVICING_AGENT,
RPD.SUM_INSURED,
RPD.TOTAL_SUM_INSURED,
RPD.BASIC_SUM_INSURED,
RPD.POLICY_TYPE,
RPD.TOTAL_AMOUNT,
--RPD.WITHDRAWAL_AMOUNT,
RPD.PREMIUM_OVERDUE,
RPD.PREMIUM_HOLIDAY_INDICATOR,
RPD.REINSTATEMENT_EFF_DATE,
RPD.EFF_POLICY_CHANGE_DATE,
RPD.TRANS_DATE,
RPD.ACTUAL_TERM_DATE,
RPD.MODAL_COMMISSION,
RPD.COMMISSION_RATE,
RPD.PAID_TO_DATE,
RPD.CLASS_CODE,
RPD.CSC_CODE,
RPD.POLICY_ADDRESS_LINE_1,
RPD.POLICY_ADDRESS_LINE_2,
RPD.POLICY_ADDRESS_LINE_3,
RPD.POLICY_ADDRESS_LINE_4,
RPD.CHINESE_POLICY_ADDRESS_LINE_1,
RPD.CHINESE_POLICY_ADDRESS_LINE_2,
RPD.CHINESE_POLICY_ADDRESS_LINE_3,
RPD.CHINESE_POLICY_ADDRESS_LINE_4,
RPD.ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
RPD.EXCLUSION,
RPD.TEMP_LOADING,
RPD.NON_FORFEITURE_OPT,				/*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_1,			    /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_2,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_3,             /*  DAPH-1192  */
RPD.ASSIGNEE_ADDRESS_4,             /*  DAPH-1192  */
RPD.ASSIGNEE_CITY,                  /*  DAPH-1192  */
RPD.EXP_DATE_OF_TEMP_LOADING,       /*  DAPH-1192  */
RPD.MAINTENANCE_CD,                 /*  DAPH-1192  */
RPD.SOURCE_CD,						/*  DAPH-1192  */
RPD.LILSP,		/*NBPT*/
RPD.LBPRM,		/*NBPT*/
RPD.PMPREM,		/*NBPT*/
RPD.LPRL,		/*NBPT*/
RPD.CHINESE_ASSIGNEE_ADDRESS_1,
RPD.CHINESE_ASSIGNEE_ADDRESS_2,
RPD.CHINESE_ASSIGNEE_ADDRESS_3,
RPD.CHINESE_ASSIGNEE_ADDRESS_4,
RPD.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPD.OWNER_GENDER, /* DASI ENHANCEMENT */
RPD.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPD.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPD.PARTY_ROLE_CD_INS, /* DASI ENHANCEMENT */
ROW_NUMBER() OVER (PARTITION BY RPD.POLICY_NUMBER, RPD.POLICY_EFFECTIVE_DATE ORDER BY RPD.TRANS_DATE DESC) AS REC_CNT
FROM
(
SELECT
RPOL.PNO AS POLICY_NUMBER,
RPOL.POLICY_EFFECTIVE_DATE,
RPOL.POLICY_ISSUE_DATE,
RPOL.POLICY_TERMINATION_DATE,
RPOL.SUBMISSION_DATE,
RPOL.PCCY  AS CURRENCY,
RPOL.PSTU  AS POLICY_STATUS,
NULL AS DIVIDEND_OPTION,
NULL AS ACCUMULATED_DIVIDEND,
NULL AS ACCUMULATED_DIV_INTRST,
NULL AS ADDITIONAL_PAID_UP_AMOUNT,
NULL  AS FACE_VAL_ON_RVRSNRY_BONUS,
NULL  AS FACE_VAL_ON_TRMNL_BONUS,
NULL AS BONUS_IN_FACE_VALUE_AMOUNT,
NULL AS ADDITIONAL_PAID_UP_FACE_VALUE,
RPOL.LSCHB AS COUPON_AMOUNT,
NULL AS DATE_OF_COST_INS_UPD,
NULL AS LOAN_BALANCE,
NULL AS LOAN_BLNCE_INTEREST,
NULL AS DEATH_BNFT_OPTIONS,
NULL AS INDEXATION_STATE,
NULL AS POLICY_INDEXATION_TYPE,
RPOL.PCOMM AS COMMUNICATION_MEANS,       /*  DASG-2515  */
NULL AS SMS,
NULL AS SUS_SMS,
NULL AS SUS_EMAIL,
NULL AS ESERVICE_INDICATOR,
NULL AS MAE_OPTION_CODE,
NULL AS COUPON_INTEREST,
NULL AS REDUCED_PAID_UP,
NULL AS PURE_ENDOWMENT,
NULL  AS ETA_EXPIRY_DATE,
NULL  AS ASSIGNEE_TYPE_CODE,
RPOL.HPLAN AS PLAN_CODE,
RPOL.PEXP AS EXPIRY_DATE,
NULL AS INITIAL_LS_PREMIUM,
NULL AS REGULAR_TOPUP_PREMIUM,
RPOL.HFPDB AS FUTURE_PREMIUM_DEPOSIT,
NULL AS MODAL_PREMIUM,
RPOL.HFPDI  AS FUTURE_PREM_DEPOSIT_INTEREST,
NULL AS PREMIUM_DUE_DATE,
NULL AS PREMIUM_HOLIDAY_START,
NULL AS PREMIUM_HOLIDAY_END,
RPOL.PMODE AS PAYMENT_MODE_CD,
RPOL.PMTHOD AS PAYMENT_METHOD,
RPOL.POWNER AS OWNER_LAST_NAME,
RPOL.OWNER_PARTY_TYP_CD,
CASE WHEN RPOL.POWNER IS NOT NULL OR RPOL.POWNID IS NOT NULL THEN(RPOL.PNO|| ':OWN') ELSE NULL END AS OWNER_PARTY_ID,
RPOL.POWNID AS OWNER_ID_DOC_NUMBER,
'SECURITYNO' AS ID_DOCUMENT_TYPE,
RPOL.PNAME AS INSRD_LAST_NAME,
RPOL.DATE_OF_BIRTH,
RPOL.PSEX AS GENDER,
RPOL.INSRD_PARTY_TYP_CD,
(RPOL.PNO|| ':INS') AS INSRD_PARTY_ID,
RPOL.PID AS INS_ID_DOCUMENT_NUMBER,
NULL AS ASSIGNEE_NAME,
NULL AS ASSIGNEE_TYPE,
CASE
	WHEN TRIM(RPOL.PPAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT1,-(LENGTH(PPAGT1)),(LENGTH(PPAGT1)-8))||'-'||SUBSTR(RPOL.PPAGT1,-8,2)||'-'||SUBSTR(RPOL.PPAGT1,-6)
END AS PRODUCING_AGENT_CD_1,
CASE
	WHEN TRIM(RPOL.PPAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PPAGT2,-(LENGTH(PPAGT2)),(LENGTH(PPAGT2)-8))||'-'||SUBSTR(RPOL.PPAGT2,-8,2)||'-'||SUBSTR(RPOL.PPAGT2,-6)
END AS PRODUCING_AGENT_CD_2,
CASE
	WHEN TRIM(RPOL.PAGT1)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT1,-(LENGTH(PAGT1)),(LENGTH(PAGT1)-8))||'-'||SUBSTR(RPOL.PAGT1,-8,2)||'-'||SUBSTR(RPOL.PAGT1,-6)
END AS SERVICING_AGENT_CD_1,
CASE
	WHEN TRIM(RPOL.PAGT2)='0' THEN NULL
	ELSE SUBSTR(RPOL.PAGT2,-(LENGTH(PAGT2)),(LENGTH(PAGT2)-8))||'-'||SUBSTR(RPOL.PAGT2,-8,2)||'-'||SUBSTR(RPOL.PAGT2,-6)
END AS SERVICING_AGENT_CD_2,
RPOL.ACTUAL_SERVICING_AGENT,
NULL AS SUM_INSURED,
NULL AS TOTAL_SUM_INSURED,
NULL AS BASIC_SUM_INSURED,
RPOL.POLICY_TYPE,
RPOL.TOTAL_AMOUNT,
--RPOL.WITHDRAWAL_AMOUNT,
RPOL.PREMIUM_OVERDUE,
NULL AS PREMIUM_HOLIDAY_INDICATOR,
RPOL.REINSTATEMENT_EFF_DATE,
RPOL.EFF_POLICY_CHANGE_DATE,
RPOL.TRANS_DATE,
RPOL.ACTUAL_TERM_DATE,
RPOL.PMCOMM AS MODAL_COMMISSION,
RPOL.COMMISSION_RATE,
RPOL.PAID_TO_DATE,
RPOL.CLASS_CODE,
RPOL.CSC_CODE,
RPOL.PADR1 AS POLICY_ADDRESS_LINE_1,
RPOL.PADR2 AS POLICY_ADDRESS_LINE_2,
RPOL.PADR3 AS POLICY_ADDRESS_LINE_3,
RPOL.PADR4 AS POLICY_ADDRESS_LINE_4,
RPOL.E59PCCA1 AS CHINESE_POLICY_ADDRESS_LINE_1,
RPOL.E59PCCA2 AS CHINESE_POLICY_ADDRESS_LINE_2,
RPOL.E59PCCA3 AS CHINESE_POLICY_ADDRESS_LINE_3,
RPOL.E59PCCA4 AS CHINESE_POLICY_ADDRESS_LINE_4,
RPOL.ACTIVITY_SUSPENSION_FLG,			/* DATH-686 */
RPOL.HEXCL AS EXCLUSION,
NULL AS TEMP_LOADING,
NULL AS NON_FORFEITURE_OPT,				/*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_1,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_2,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_3,                /*  DAPH-1192  */
NULL AS ASSIGNEE_ADDRESS_4,                /*  DAPH-1192  */
NULL AS ASSIGNEE_CITY,                     /*  DAPH-1192  */
NULL AS EXP_DATE_OF_TEMP_LOADING,          /*  DAPH-1192  */
RPOL.MAINTENANCE_CD,                    /*  DAPH-1192  */
RPOL.SOURCE_CD,                          /*  DAPH-1192  */
NULL AS LILSP,		/*NBPT*/
NULL AS LBPRM,		/*NBPT*/
NULL AS PMPREM,		/*NBPT*/
NULL AS LPRL,		/*NBPT*/
RPOL.E59PCAA1 AS CHINESE_ASSIGNEE_ADDRESS_1,
RPOL.E59PCAA2 AS CHINESE_ASSIGNEE_ADDRESS_2,
RPOL.E59PCAA3 AS CHINESE_ASSIGNEE_ADDRESS_3,
RPOL.E59PCAA4 AS CHINESE_ASSIGNEE_ADDRESS_4,
RPOL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
RPOL.OWNER_GENDER, /* DASI ENHANCEMENT */
RPOL.OWNER_MOBILE, /* DASI ENHANCEMENT */
RPOL.OWNER_EMAIL, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
RPOL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(

SELECT
POL.PNO,
POL.POLICY_EFFECTIVE_DATE,
POL.POLICY_ISSUE_DATE,
POL.POLICY_TERMINATION_DATE,
POL.SUBMISSION_DATE,
POL.PCCY,
POL.POLICY_TYPE,
POL.PSTU,
POL.LSCHB,
POL.LSCHI,
POL.REINSTATEMENT_EFF_DATE,
POL.EFF_POLICY_CHANGE_DATE,
POL.TRANS_DATE,
POL.TERMINATE_DATE,
POL.ACTUAL_TERM_DATE,
POL.PMCOMM,
POL.COMMISSION_RATE,
POL.HPLAN,
POL.PEXP,
POL.HFPDB,
POL.HFPDI,
POL.PMODE,
POL.PPTD,
POL.PMTHOD,
POL.POWNER,
POL.OWNER_PARTY_TYP_CD,
POL.POWNID,
POL.ID_DOCUMENT_TYPE,
POL.OWNER_PARTY_ID,
POL.PADR1,
POL.PADR2,
POL.PADR3,
POL.PADR4,
POL.HOM_ADDRESS_TYPE,
POL.OFF_ADDRESS_TYPE,
POL.PNAME,
POL.DATE_OF_BIRTH,
POL.PSEX ,
POL.INSRD_PARTY_TYP_CD,
POL.INSRD_PARTY_ID,
POL.PID,
POL.HOME_TLPHN_ADDR_TYP_CD,
POL.MOB_TLPHN_ADDR_TYP_CD,
POL.OFF_TLPHN_ADDR_TYP_CD,
POL.ELCTRNC_ADDR_TYP_CD,
POL.PAID_TO_DATE,
POL.CLASS_CODE,
POL.CSC_CODE,
POL.PPAGT1,
POL.PPAGT2,
POL.PAGT1,
POL.PAGT2,
POL.ACTUAL_SERVICING_AGENT,
CASE
	WHEN POL.POLICY_TYPE = 'UNIT LINK' THEN LFPODSAS.ASSURV
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) THEN LFPODSPS.PSTAMT
END TOTAL_AMOUNT,
/*CASE 
	WHEN POL.POLICY_TYPE = 'UNIT LINK' AND LFPUFTD.N9TCOD='AW' AND LFPUFTDH.M2TCOD='AW' THEN (LFPUFTD.N9AMTP + LFPUFTDH.M2AMTP) 
	WHEN POL.POLICY_TYPE IN ('TERM PLAN', 'ENDOWMENT', 'WHOLE LIFE' ) AND (LFPACT.ACTCD LIKE 'AW%' OR LFPACTC.ACTCD LIKE 'AW%') THEN (NVL(LFPACT.ACAMT,0) + NVL(LFPACTC.ACAMT,0))
END AS WITHDRAWAL_AMOUNT,*/
POL.PREMIUM_OVERDUE,
POL.PMPREM,
LFPTCINF.E59PCCA1,
LFPTCINF.E59PCCA2,
LFPTCINF.E59PCCA3,
LFPTCINF.E59PCCA4,
POL.ACTIVITY_SUSPENSION_FLG,			/* DATH-686 */
POL.HEXCL,
POL.MAINTENANCE_CD,                 /*  DAPH-1192  */
POL.SOURCE_CD,                       /*  DAPH-1192  */
POL.PCOMM,                           /*  DASG-2515  */
LFPTCINF.E59PCAA1,
LFPTCINF.E59PCAA2,
LFPTCINF.E59PCAA3,
LFPTCINF.E59PCAA4,
POL.OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
POL.OWNER_GENDER, /* DASI ENHANCEMENT */
POL.OWNER_MOBILE, /* DASI ENHANCEMENT */
POL.OWNER_EMAIL, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_OWN, /* DASI ENHANCEMENT */
POL.PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
(
SELECT
LFPPMH.PNO,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PEFF)),1,TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD'))  AS POLICY_EFFECTIVE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PDOI)),1,TO_DATE(TO_CHAR(LFPPMH.PDOI),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD'))  AS POLICY_ISSUE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PTERM)),1,TO_DATE(TO_CHAR(LFPPMH.PTERM),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD'))  AS POLICY_TERMINATION_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PDOS)),1,TO_DATE(TO_CHAR(LFPPMH.PDOS),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD'))  AS SUBMISSION_DATE,
LFPPMH.PCCY,
LFPPMH.PPAGT1,
LFPPMH.PPAGT2,
LFPPMH.PAGT1,
LFPPMH.PAGT2,
CASE 
	WHEN SATB.LFASA IS NOT NULL THEN SUBSTR(LFASA,-(LENGTH(LFASA)),(LENGTH(LFASA)-8))||'-'||SUBSTR(LFASA,-8,2)||'-'||SUBSTR(LFASA,-6)
	ELSE NULL
END ACTUAL_SERVICING_AGENT,
CASE 
	WHEN TBP.PLSBGP IN ('16','17') THEN 'TERM PLAN'
	WHEN TBP.PLSBGP IN ('11','12', '13') THEN 'WHOLE LIFE'
	WHEN TBP.PLSBGP IN ('14','15') THEN 'ENDOWMENT'
	WHEN TBP.PLSBGP IN ('33','34') THEN 'HEALTH/HOSPITAL'
	WHEN TBP.PLSBGP = '18' THEN 'UNIT LINK'
	ELSE 'TRADITIONAL'
END POLICY_TYPE,
CASE
	WHEN (DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PPTD)),1,TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD')) < TRUNC(SYSDATE) AND LFPPMH.PSTU NOT IN('2','3','4','7','8','9','A','C','D','E','Z')) THEN 'YES'
	ELSE 'NO'
END PREMIUM_OVERDUE,
LFPPMH.PSTU,
LFPPMH.LSCHB,
LFPPMH.LSCHI,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PREFF)),1,TO_DATE(TO_CHAR(LFPPMH.PREFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS REINSTATEMENT_EFF_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PTEFF)),1,TO_DATE(TO_CHAR(LFPPMH.PTEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS EFF_POLICY_CHANGE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PDOT)),1,TO_DATE(TO_CHAR(LFPPMH.PDOT),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TRANS_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PTERM)),1,TO_DATE(TO_CHAR(LFPPMH.PTERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS TERMINATE_DATE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PATERM)),1,TO_DATE(TO_CHAR(LFPPMH.PATERM),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS ACTUAL_TERM_DATE,
LFPPMH.PMCOMM,
CASE 
  WHEN IS_DATE_DAPI(TO_CHAR(LFPPMH.PEFF))=0 THEN PAGTC11
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 1) OR (IS_DATE_DAPI(TO_CHAR(LFPPMH.PPTD))=0) THEN PAGTC1
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 2) THEN PAGTC2
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 3) THEN PAGTC3
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 4) THEN PAGTC4
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 5) THEN PAGTC5
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 6) THEN PAGTC6
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 7) THEN PAGTC7
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 8) THEN PAGTC8
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 9) THEN PAGTC9
	WHEN ((TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYYMMDD')- TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYYMMDD'))/365 <= 10) THEN PAGTC10
	ELSE PAGTC11
END AS COMMISSION_RATE,
LFPPMH.HPLAN,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PEXP)),1,TO_DATE(TO_CHAR(LFPPMH.PEXP),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PEXP,
LFPPMH.HFPDB, 
LFPPMH.HFPDI,
LFPPMH.PMODE,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PPTD)),1,TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PPTD,
LFPPMH.PMTHOD,
LFPPMH.POWNER,
'OWN' AS OWNER_PARTY_TYP_CD,
LFPPMH.POWNID,
'SECURITYNO' AS ID_DOCUMENT_TYPE,
LFPPMH.PNO||':OWN' AS OWNER_PARTY_ID,
LFPPMH.PADR1,
LFPPMH.PADR2,
LFPPMH.PADR3,
LFPPMH.PADR4,
'HOM' AS HOM_ADDRESS_TYPE,
'OFF' AS OFF_ADDRESS_TYPE,
LFPPMH.PNAME,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PDOB)),1,TO_DATE(TO_CHAR(LFPPMH.PDOB),'YYYYMMDD'),TO_DATE('19000101','YYYY-MM-DD')) AS DATE_OF_BIRTH,
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PPTD)),1,TO_DATE(TO_CHAR(LFPPMH.PPTD),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS PAID_TO_DATE,
LFPPMH.HCLS AS CLASS_CODE,
LFPPMH.PCSCD AS CSC_CODE,
LFPPMH.PSEX ,
'INS' AS INSRD_PARTY_TYP_CD,
LFPPMH.PNO||':INS' AS INSRD_PARTY_ID,
LFPPMH.PID,
LFPPMH.PTEL1,
LFPPMH.PTEL2,
'HOM' AS HOME_TLPHN_ADDR_TYP_CD,
'MOB' AS MOB_TLPHN_ADDR_TYP_CD,
'OFF' AS OFF_TLPHN_ADDR_TYP_CD,
LFPPMH.PIEMAL,
'EML' AS ELCTRNC_ADDR_TYP_CD,
LFPPMH.PMPREM,
LFPPMH.PSUSF AS ACTIVITY_SUSPENSION_FLG,		/* DATH-686 */
LFPPMH.HEXCL,
LFPPMH.PTC AS MAINTENANCE_CD,		/*  DAPH-1192  */
LFPPMH.PSOUR AS SOURCE_CD,			/*  DAPH-1192  */
LFPPMH.PCOMM ,                   /*  DASG-2515  */
DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.HPAYDB)),1,TO_DATE(TO_CHAR(LFPPMH.HPAYDB),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) AS OWNER_DATE_OF_BIRTH, /* DASI ENHANCEMENT */
LFPPMH.POWSEX AS OWNER_GENDER, /* DASI ENHANCEMENT */
LFPPMH.PMOMBNO AS OWNER_MOBILE, /* DASI ENHANCEMENT */
LFPPMH.PEMAL AS OWNER_EMAIL, /* DASI ENHANCEMENT */
CASE WHEN TRIM(LFPPMH.POWNER) IS NOT NULL THEN 'OWN' END AS PARTY_ROLE_CD_OWN,  /* DASI ENHANCEMENT */
'INS' AS PARTY_ROLE_CD_INS /* DASI ENHANCEMENT */
FROM
MR_LFPPMH LFPPMH
LEFT OUTER JOIN MR_TABPLAN TBP
ON LFPPMH.HPLAN = TBP.PLAN
LEFT OUTER JOIN MR_LFPASATB SATB
ON LFPPMH.PNO=SATB.LFPNO
WHERE LFPPMH.PNO = '%policyNumber%'	/* INPUT POLICY NUMBER */ 
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PEFF)),1,TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD'))>= TO_DATE('1900-01-01','YYYY-MM-DD')  /* INPUT POLICY_EFFECTIVE_FROM_DATE */
AND DECODE(IS_DATE_DAPI(TO_CHAR(LFPPMH.PEFF)),1,TO_DATE(TO_CHAR(LFPPMH.PEFF),'YYYY-MM-DD'),TO_DATE('19000101','YYYY-MM-DD')) <= TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD') 	/* INPUT POLICY_EFFECTIVE_TO_DATE */
)POL
LEFT OUTER JOIN MR_LFPODSAS LFPODSAS
ON LFPODSAS.ASPNO = POL.PNO
LEFT OUTER JOIN MR_LFPODSPS LFPODSPS
ON LFPODSPS.PSPNO = POL.PNO
/*LEFT OUTER JOIN MR_LFPUFTD LFPUFTD
ON POL.PNO = LFPUFTD.N9PNO
LEFT OUTER JOIN MR_LFPUFTDH LFPUFTDH
ON POL.PNO = LFPUFTDH.M2PNO
LEFT OUTER JOIN MR_LFPACT LFPACT
ON POL.PNO = LFPACT.ACPNO
LEFT OUTER JOIN MR_LFPACTC LFPACTC
ON POL.PNO = LFPACTC.ACPNO*/
LEFT OUTER JOIN MR_LFPTCINF LFPTCINF
ON POL.PNO=LFPTCINF.E59PNO
)RPOL 
)RPD
) POL_DETAILS
WHERE POL_DETAILS.REC_CNT = 1