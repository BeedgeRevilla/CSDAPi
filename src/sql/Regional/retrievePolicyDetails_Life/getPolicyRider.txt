SELECT
DISTINCT  NVL(C.C40LNKPNO, B.C40PNO) RIDER_POLICY,
NVL(C.C40LNKPCD, B.C40PLNCD) RIDER_PLAN,
D.PLAND RIDER_DESC,
CASE WHEN E.F52NCR = 'Y'
	THEN 'P'
	ELSE 'R'
END PLAN_FLG
FROM (
SELECT PNO FROM MR_LFPPML WHERE PNO = '%policyNumber%' /*INPUT POLICY NUMBER*/
UNION ALL
SELECT PNO FROM MR_LFPPMH WHERE PNO = '%policyNumber%' /*INPUT POLICY NUMBER*/
UNION ALL
SELECT PNO FROM MR_LFPPMG WHERE PNO = '%policyNumber%' /*INPUT POLICY NUMBER*/
) A
LEFT OUTER JOIN MR_LFPLNKPOL B ON A.PNO = B.C40LNKPNO
LEFT OUTER JOIN MR_LFPLNKPOL C ON A.PNO = C.C40PNO
LEFT OUTER JOIN MR_TABPLAN D ON D.PLAN = NVL(C.C40LNKPCD, B.C40PLNCD)
LEFT OUTER JOIN MR_LFPTBPROC E ON E.F52PLAN = NVL(C.C40LNKPCD, B.C40PLNCD)