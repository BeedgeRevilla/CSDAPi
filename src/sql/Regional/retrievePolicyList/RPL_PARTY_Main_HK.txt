WITH PR AS 
(		
	SELECT /*+ FIRST_ROWS(50) */  *   /* Required for Wild card search */
	FROM 
	(
		SELECT 
		PP.AFFILIATE_CD,PP.CERTIFICATE_NO,PP.DEPENDENT_NO,PP.BENEFICIARY_ID,POLICY_RK,PP.PARTY_ROLE_CD,PP.PARTY_RK,PP.TRANS_NO,PP.POLICY_ROLE_RK,
		PP.COMPANY_CD,PP.PARTY_ID,PP.PARTY_STAT_CD,PP.LOCAL_FIRST_NM,PP.LOCAL_LAST_NM,
		PP.LOCAL_DISPLAY_NM_FORMAT,PP.GENDER_CD,PP.BIRTH_DT,PP.FORM_60_FLG,PP.IDENTITY_PROOF_IND,PP.SALUTATION_TXT,
		PP.MARITAL_STAT_CD,PP.NATIONALITY_CD,PP.GEO_DEMOGRAPHIC_CD,PP.COUNTRY_OF_RESIDENCE_CD,PP.OCCUPATION_CLASS_CD,
		PP.DECEASED_FLG,PP.DEATH_DT,PP.ALERT_RECEIVER_NM,PP.SOURCE_OF_INCOME,PP.ANNUAL_INCOME_AMT,PP.ANNUAL_INCOME_RANGE_CD,
		PP.EDUCATION_LEVEL_CD,PP.HEIGHT_IN_MTR,PP.WEIGHT_IN_KG,PP.STF_NO,PP.STF_FLG,PP.PRIMARY_LANG_CD,PP.SPCL_NEED_CD,
		PP.PREF_CONTACT_METHOD_CD,PP.STD_GENDER_CD,PP.STD_MARITAL_STAT_CD,PP.STD_NATIONALITY_CD,PP.STD_OCCUPATION_CLASS_CD,
		PP.FIRST_NM,
		PP.LAST_NM,
		PP.DISPLAY_NM_FORMAT ,
		PP.PARTY_TYPE_CD,
		ROW_NUMBER() OVER ( PARTITION BY PP.POLICY_ROLE_RK ORDER BY PP.VALID_FROM_DTTM DESC,PP.TRANS_NO DESC ) AS VALID_REC
		FROM		
		(	
			SELECT 
			PRP.AFFILIATE_CD,PRP.CERTIFICATE_NO,PRP.DEPENDENT_NO,PRP.BENEFICIARY_ID,POLICY_RK,PRP.PARTY_ROLE_CD,PRP.PARTY_RK,PRP.TRANS_NO,PRP.POLICY_ROLE_RK,
            PR.COMPANY_CD,PR.PARTY_ID,PR.PARTY_STAT_CD,PR.LOCAL_FIRST_NM,PR.LOCAL_LAST_NM,PRP.VALID_FROM_DTTM,
			PR.LOCAL_DISPLAY_NM_FORMAT,PR.GENDER_CD,PR.BIRTH_DT,PR.FORM_60_FLG,PR.IDENTITY_PROOF_IND,PR.SALUTATION_TXT,
			PR.MARITAL_STAT_CD,PR.NATIONALITY_CD,PR.GEO_DEMOGRAPHIC_CD,PR.COUNTRY_OF_RESIDENCE_CD,PR.OCCUPATION_CLASS_CD,
			PR.DECEASED_FLG,PR.DEATH_DT,PR.ALERT_RECEIVER_NM,PR.SOURCE_OF_INCOME,PR.ANNUAL_INCOME_AMT,PR.ANNUAL_INCOME_RANGE_CD,
			PR.EDUCATION_LEVEL_CD,PR.HEIGHT_IN_MTR,PR.WEIGHT_IN_KG,PR.STF_NO,PR.STF_FLG,PR.PRIMARY_LANG_CD,PR.SPCL_NEED_CD,
			PR.PREF_CONTACT_METHOD_CD,PR.STD_GENDER_CD,PR.STD_MARITAL_STAT_CD,PR.STD_NATIONALITY_CD,PR.STD_OCCUPATION_CLASS_CD,
			PR.FIRST_NM,
			PR.LAST_NM,
			PR.DISPLAY_NM_FORMAT ,
			PR.PARTY_TYPE_CD
			FROM PARTY_ROLE_POLICY PRP
			INNER JOIN PARTY PR ON PR.PARTY_RK=PRP.PARTY_RK AND PRP.PARTY_ROLE_CD='OWN'		
			WHERE TO_DATE('%toDate%','YYYY-MM-DD') >= PRP.VALID_FROM_DTTM  /*VALUE OF VALID FROM DATE */ AND  TO_DATE('%toDate%','YYYY-MM-DD') <= PRP.VALID_TO_DTTM  /*VALUE OF VALID TO DATE*/AND EXISTS(	SELECT * FROM(SELECT PARTY_RK FROM PARTY_IDENTIFIER WHERE ID_DOC_TYPE_CD='SECURITYNO'AND SRCH_ID_DOC_NO LIKE UPPER(REGEXP_REPLACE(REVERSE('%idDocumentNumber%'), '[^0-9A-Za-z]', '')||'%') /*VALUE OF TAX_ID*/)PI	WHERE PR.PARTY_RK=PI.PARTY_RK)
		) PP
		
	) 
WHERE VALID_REC=1 AND ROWNUM <= 50   /* Required for Wild card search */
)
SELECT /*+ FIRST_ROWS(50) */  /* Required for Wild card search */
POLICY_NUMBER,
POLICY_TYPE_LOB,
POLICY_TYPE_STD_LOB, 
POLICY_STATUS_CODE,
AGENT_CODE,
POLICY_EFFECTIVE_DATE,
POLICY_EXPIRATION_DATE,
COMPANY_CODE,
LOB_CODE, 
STD_LOB_CODE,
PROD_CD,
SOURCE_SYSTEM_CODE, 
RISK_XML_VALUE,
FIRST_NAME,
LAST_NAME,
DISPLAY_NAME_FORMAT,
PARTY_TYPE,
--PARTY_XML_VALUE,
VERSION_NO,
ISSUE_TYPE_CD,
PREVIOUS_POLICY_NO,
SOURCE_CHNL_CD,
STD_SOURCE_CHNL_CD,
ORIGINAL_INCEPTION_DT,
POLICY_ISSUE_DT,
POLICY_RNWL_DT,
PAID_TO_DT,
PAYMENT_MODE_CD,
REFERERER_ID,
JACKET_CD,
POLICY_CURRENCY_CD,
STD_CURRENCY_CD,
HEALTH_COV_FLG,
GRP_POLICY_FLG,
PARTY_ID,
PARTY_STAT_CD,
LOCAL_FIRST_NM,
LOCAL_LAST_NM,
LOCAL_DISPLAY_NM_FORMAT,
GENDER_CD,
BIRTH_DT,
FORM_60_FLG,
IDENTITY_PROOF_IND,
SALUTATION_TXT,
MARITAL_STAT_CD,
NATIONALITY_CD,
GEO_DEMOGRAPHIC_CD,
COUNTRY_OF_RESIDENCE_CD,
OCCUPATION_CLASS_CD,
DECEASED_FLG,
DEATH_DT,
ALERT_RECEIVER_NM,
SOURCE_OF_INCOME,
ANNUAL_INCOME_AMT,
ANNUAL_INCOME_RANGE_CD,
EDUCATION_LEVEL_CD,
HEIGHT_IN_MTR,
WEIGHT_IN_KG,
STF_NO,
STF_FLG,
PRIMARY_LANG_CD,
SPCL_NEED_CD,
PREF_CONTACT_METHOD_CD,
STD_GENDER_CD,
STD_MARITAL_STAT_CD,
STD_NATIONALITY_CD,
STD_OCCUPATION_CLASS_CD,
AGNT_EFF_DT,
AGNT_TERMINATION_DT,
AGNT_TERMINATION_CD,
AGNT_TERMINATION_DESC,
AGNT_STAT_CD,
AGNT_TYPE_CD,
AGNT_ROLE_CD,
AGNT_POS_CD,
AGNT_UNIT_CD,
LAST_POS_CHNG_DT,
AGNT_IARB_RGSTRN_NO,
RGSTRN_EFF_DT,
RGSTRN_RNWL_DT,
CONTACT_PERSON,
BLCKLST_FLG,
FIN_FLG,
CA_FLG,
DUMMY_AGNT_FLG,
EHP_FLG,
ASP_FLG,
ELGBLTY_CD,
IIQE_IL_ELGBLTY_CD,
CRRPNDNCE_UNIT_CD,
CRRPNDNCE_LEVEL_CD,
CRRPNDNCE_AGNT_CD,
GA_OFFICE_CD,
GA_OFFICE_NM,
PIN_CD,
CAB_CD,
MPF_RGSTRN_NO,
MPF_RGSTRN_DT,
MPFA_NOTIFICATION_DT,
TL_ELGBLTY_FLG,
FP_ELGBLTY_FLG,
--ID_DOC_TYPE_CD,
--ID_CHECK_DIGIT,
PROD_NM,
LOCAL_PROD_NM,
AFFILIATE_CD,
CERTIFICATE_NO,
DEPENDENT_NO,
BENEFICIARY_ID,
GROSS_PREM_AMT,     --added for R2
NET_PREM_AMT,	    --added for R2
LAST_PAYMENT_DT,	--added for R2
LF_MOD_PREM_AMT,	--added for R2
LF_SUM_INSURED_AMT,
ENTITY_CD,		--added for R2
INSURED_LAST_NAME,	--NEWLY ADDED FOR INSURED INFO
INSURED_PARTY_ID,	--NEWLY ADDED FOR INSURED INFO
APPLICATION_SERIAL_NO,	-- ADDED FOR SMARTCLAIMS R2
CERT_NO	,-- ADDED FOR SMARTCLAIMS R2
OPEN_POL	-- ADDED FOR SMARTCLAIMS R2
FROM
(
	SELECT 
	TBL.POLICY_NUMBER,
	TBL.POLICY_TYPE_LOB,
	TBL.POLICY_TYPE_STD_LOB, 
	TBL.POLICY_STATUS_CODE,
	TBL.AGENT_CODE,
	TBL.POLICY_EFFECTIVE_DATE,
	TBL.POLICY_EXPIRATION_DATE,
	TBL.COMPANY_CODE,
	TBL.LOB_CODE, 
	TBL.STD_LOB_CODE,
	TBL.PROD_CD,
       TBL.INSURED_LAST_NAME,	--Newly added
	TBL.INSURED_PARTY_ID,	--Newly ADDED
	TBL.SOURCE_SYSTEM_CODE,
	(
		SELECT XMLELEMENT("policyItem",XMLAGG(XMLELEMENT("policyItems",XMLFOREST(PC_LI.COVERAGE_CD AS "riskNo",PC_LI.POL_ITEM_NM AS "name",PC_LI.POL_ITEM_VAL AS "value",PC_LI.COVERAGE_TYPE_CD  AS "COVERAGE_TYPE_CD",
		PC_LI.ATTACHMENT_DTTM AS "ATTACHMENT_DATE",	--ADDED FOR SMARTCLAIMS R2
		PC_LI.VALID_TO_DTTM AS "TERMINATION_DATE"	--ADDED FOR SMARTCLAIMS R2
		)))).getClobval() FROM
		(
			SELECT 
			POLICY_RK,VALID_FROM_DTTM,VALID_TO_DTTM,POL_ITEM_NM,POL_ITEM_VAL,COVERAGE_CD,
			COVERAGE_TYPE_CD, -- ADDED FOR UAT-9983
			ATTACHMENT_DTTM		-- ADDED FOR SMARTCLAIMS R2
			FROM 
			(
				SELECT PT.*,
				ROW_NUMBER() OVER ( PARTITION BY PT.POLICY_ITEM_RK ORDER BY PT.VALID_FROM_DTTM DESC,PT.TRANS_NO DESC ) AS VALID_REC
				FROM POLICY_ITEM PT
				INNER JOIN PR ON PT.POLICY_RK=PR.POLICY_RK WHERE PT.COVERAGE_CD != '0'
				AND PT.COVERAGE_TYPE_CD IS NOT NULL
				AND TO_DATE('%toDate%','YYYY-MM-DD') >=PT.VALID_FROM_DTTM  /*VALUE FOR VALID FROM DATE*/ AND  TO_DATE('%toDate%','YYYY-MM-DD') <=PT.VALID_TO_DTTM  /*VALUE FOR VALID TO DATE*/ORDER BY COVERAGE_CD
			)
			WHERE VALID_REC=1
		) PC_LI WHERE PC_LI.POLICY_RK = TBL.POLICY_RK
	) AS "RISK_XML_VALUE",
	TBL.FIRST_NAME,
	TBL.LAST_NAME,
	TBL.DISPLAY_NAME_FORMAT,
	TBL.PARTY_TYPE,
	--TBL.CHASSIS_NUMBER,
	TBL.VERSION_NO,
	TBL.ISSUE_TYPE_CD,
	TBL.PREVIOUS_POLICY_NO,
	TBL.SOURCE_CHNL_CD,
	TBL.STD_SOURCE_CHNL_CD,
	TBL.ORIGINAL_INCEPTION_DT,
	TBL.POLICY_ISSUE_DT,
	TBL.POLICY_RNWL_DT,
	TBL.PAID_TO_DT,
	TBL.PAYMENT_MODE_CD,
	TBL.REFERERER_ID,
	TBL.JACKET_CD,
	TBL.POLICY_CURRENCY_CD,
	TBL.STD_CURRENCY_CD,
	TBL.HEALTH_COV_FLG,
	TBL.GRP_POLICY_FLG,
	TBL.PARTY_ID,
	TBL.PARTY_STAT_CD,
	TBL.LOCAL_FIRST_NM,
	TBL.LOCAL_LAST_NM,
	TBL.LOCAL_DISPLAY_NM_FORMAT,
	TBL.GENDER_CD,
	TBL.BIRTH_DT,
	TBL.FORM_60_FLG,
	TBL.IDENTITY_PROOF_IND,
	TBL.SALUTATION_TXT,
	TBL.MARITAL_STAT_CD,
	TBL.NATIONALITY_CD,
	TBL.GEO_DEMOGRAPHIC_CD,
	TBL.COUNTRY_OF_RESIDENCE_CD,
	TBL.OCCUPATION_CLASS_CD,
	TBL.DECEASED_FLG,
	TBL.DEATH_DT,
	TBL.ALERT_RECEIVER_NM,
	TBL.SOURCE_OF_INCOME,
	TBL.ANNUAL_INCOME_AMT,
	TBL.ANNUAL_INCOME_RANGE_CD,
	TBL.EDUCATION_LEVEL_CD,
	TBL.HEIGHT_IN_MTR,
	TBL.WEIGHT_IN_KG,
	TBL.STF_NO,
	TBL.STF_FLG,
	TBL.PRIMARY_LANG_CD,
	TBL.SPCL_NEED_CD,
	TBL.PREF_CONTACT_METHOD_CD,
	TBL.STD_GENDER_CD,
	TBL.STD_MARITAL_STAT_CD,
	TBL.STD_NATIONALITY_CD,
	TBL.STD_OCCUPATION_CLASS_CD,
	TBL.AGNT_EFF_DT,
	TBL.AGNT_TERMINATION_DT,
	TBL.AGNT_TERMINATION_CD,
	TBL.AGNT_TERMINATION_DESC,
	TBL.AGNT_STAT_CD,
	TBL.AGNT_TYPE_CD,
	TBL.AGNT_ROLE_CD,
	TBL.AGNT_POS_CD,
	TBL.AGNT_UNIT_CD,
	TBL.LAST_POS_CHNG_DT,
	TBL.AGNT_IARB_RGSTRN_NO,
	TBL.RGSTRN_EFF_DT,
	TBL.RGSTRN_RNWL_DT,
	TBL.CONTACT_PERSON,
	TBL.BLCKLST_FLG,
	TBL.FIN_FLG,
	TBL.CA_FLG,
	TBL.DUMMY_AGNT_FLG,
	TBL.EHP_FLG,
	TBL.ASP_FLG,
	TBL.ELGBLTY_CD,
	TBL.IIQE_IL_ELGBLTY_CD,
	TBL.CRRPNDNCE_UNIT_CD,
	TBL.CRRPNDNCE_LEVEL_CD,
	TBL.CRRPNDNCE_AGNT_CD,
	TBL.GA_OFFICE_CD,
	TBL.GA_OFFICE_NM,
	TBL.PIN_CD,
	TBL.CAB_CD,
	TBL.MPF_RGSTRN_NO,
	TBL.MPF_RGSTRN_DT,
	TBL.MPFA_NOTIFICATION_DT,
	TBL.TL_ELGBLTY_FLG,
	TBL.FP_ELGBLTY_FLG,
	--TBL.ID_DOC_TYPE_CD,
	--TBL.ID_CHECK_DIGIT,
	TBL.PROD_NM,
	TBL.LOCAL_PROD_NM,
	TBL.AFFILIATE_CD,
	TBL.CERTIFICATE_NO,
	TBL.DEPENDENT_NO,
	TBL.BENEFICIARY_ID,
	TBL.GROSS_PREM_AMT,
	TBL.NET_PREM_AMT,
	TBL.LAST_PAYMENT_DT,
	TBL.LF_MOD_PREM_AMT,
	TBL.LF_SUM_INSURED_AMT,
	TBL.ENTITY_CD,
       APPLICATION_SERIAL_NO,		-- ADDED FOR SMARTCLAIMS R2
	TBL.CERT_NO, -- ADDED FOR SMARTCLAIMS R2
	TBL.OPEN_POL, -- ADDED FOR SMARTCLAIMS R2
	ROWNUM AS RNUM
	FROM
	(
		SELECT
		POL_COV.POLICY_NO AS "POLICY_NUMBER",
		PR.FIRST_NM AS "FIRST_NAME",
		PR.LAST_NM AS "LAST_NAME",
		PR.DISPLAY_NM_FORMAT AS "DISPLAY_NAME_FORMAT",
		PR.PARTY_TYPE_CD AS "PARTY_TYPE",
		PR.LAST_NM AS "ORGANISATION_NAME",
		POL_COV.LOB_CD AS "POLICY_TYPE_LOB", 
		POL_COV.STD_LOB_CD AS "POLICY_TYPE_STD_LOB",
		POL_COV.POLICY_STAT_CD AS "POLICY_STATUS_CODE",
		AG.AGNT_CD AS "AGENT_CODE",
		POL_COV.POLICY_EFF_DT AS "POLICY_EFFECTIVE_DATE",
		POL_COV.POLICY_EXPIRATION_DT AS "POLICY_EXPIRATION_DATE",
		POL_COV.COMPANY_CD AS "COMPANY_CODE",
		PDT.PROD_CD AS "PROD_CD",  
		POL_COV.LOB_CD AS "LOB_CODE", 
		POL_COV.LOB_CD AS "STD_LOB_CODE", 
		POL_COV.SOURCE_SYSTEM_CD AS "SOURCE_SYSTEM_CODE",
		POL_COV.APPL_NO AS "COVER_NOTE", 
		--INS_INFO.LAST_NM AS INSURED_LAST_NAME,		--NEWLY ADDED
		--INS_INFO.PARTY_ID AS  INSURED_PARTY_ID,			--NEWLY ADDED
		null as INSURED_LAST_NAME,
		null as INSURED_PARTY_ID,
		POL_COV.APPL_SERIAL_NO AS "APPLICATION_SERIAL_NO",  -- ADDED FOR SMARTCLAIMS R2
		
		POL_COV.PROD_RK,POL_COV.POLICY_RK AS "POLICY_RK",POL_COV.VALID_FROM_DTTM,POL_COV.TRANS_NO,POL_COV.VALID_TO_DTTM,
		POL_COV.VERSION_NO,POL_COV.ISSUE_TYPE_CD,POL_COV.PREVIOUS_POLICY_NO,
		POL_COV.SOURCE_CHNL_CD,POL_COV.STD_SOURCE_CHNL_CD,POL_COV.ORIGINAL_INCEPTION_DT,POL_COV.POLICY_ISSUE_DT,
		POL_COV.POLICY_RNWL_DT,POL_COV.PAID_TO_DT,POL_COV.PAYMENT_MODE_CD,POL_COV.REFERERER_ID,
		POL_COV.JACKET_CD,POL_COV.POLICY_CURRENCY_CD,POL_COV.STD_CURRENCY_CD,POL_COV.HEALTH_COV_FLG,POL_COV.GRP_POLICY_FLG,	POL_COV.GROSS_PREM_AMT,
		POL_COV.NET_PREM_AMT,POL_COV.LAST_PAYMENT_DT,POL_COV.LF_SUM_INSURED_AMT,POL_COV.LF_MOD_PREM_AMT,POL_COV.ENTITY_CD,
		PR.TRANS_NO,PR.COMPANY_CD,PR.PARTY_ID,PR.PARTY_RK,PR.PARTY_STAT_CD,PR.LOCAL_FIRST_NM,PR.LOCAL_LAST_NM,
		PR.LOCAL_DISPLAY_NM_FORMAT,PR.GENDER_CD,PR.BIRTH_DT,PR.FORM_60_FLG,PR.IDENTITY_PROOF_IND,PR.SALUTATION_TXT,
		PR.MARITAL_STAT_CD,PR.NATIONALITY_CD,PR.GEO_DEMOGRAPHIC_CD,PR.COUNTRY_OF_RESIDENCE_CD,PR.OCCUPATION_CLASS_CD,
		PR.DECEASED_FLG,PR.DEATH_DT,PR.ALERT_RECEIVER_NM,PR.SOURCE_OF_INCOME,PR.ANNUAL_INCOME_AMT,PR.ANNUAL_INCOME_RANGE_CD,
		PR.EDUCATION_LEVEL_CD,PR.HEIGHT_IN_MTR,PR.WEIGHT_IN_KG,PR.STF_NO,PR.STF_FLG,PR.PRIMARY_LANG_CD,PR.SPCL_NEED_CD,
		PR.PREF_CONTACT_METHOD_CD,PR.STD_GENDER_CD,PR.STD_MARITAL_STAT_CD,PR.STD_NATIONALITY_CD,PR.STD_OCCUPATION_CLASS_CD,
		AG.AGNT_EFF_DT,AG.AGNT_TERMINATION_DT,AG.AGNT_TERMINATION_CD,AG.AGNT_TERMINATION_DESC,AG.AGNT_STAT_CD,
		AG.AGNT_TYPE_CD,AG.AGNT_ROLE_CD,AG.AGNT_POS_CD,AG.AGNT_UNIT_CD,AG.LAST_POS_CHNG_DT,AG.AGNT_IARB_RGSTRN_NO,
		AG.RGSTRN_EFF_DT,AG.RGSTRN_RNWL_DT,AG.CONTACT_PERSON,AG.BLCKLST_FLG,AG.FIN_FLG,AG.CA_FLG,AG.DUMMY_AGNT_FLG,
		AG.EHP_FLG,AG.ASP_FLG,AG.ELGBLTY_CD,AG.IIQE_IL_ELGBLTY_CD,AG.CRRPNDNCE_UNIT_CD,AG.CRRPNDNCE_LEVEL_CD,
		AG.CRRPNDNCE_AGNT_CD,AG.GA_OFFICE_CD,AG.GA_OFFICE_NM,AG.PIN_CD,AG.CAB_CD,AG.MPF_RGSTRN_NO,AG.MPF_RGSTRN_DT,
		AG.MPFA_NOTIFICATION_DT,AG.TL_ELGBLTY_FLG,AG.FP_ELGBLTY_FLG,-- PR.ID_DOC_TYPE_CD,PR.ID_CHECK_DIGIT,
		PDT.PROD_NM,PDT.LOCAL_PROD_NM,PR.AFFILIATE_CD,PR.CERTIFICATE_NO,PR.DEPENDENT_NO,PR.BENEFICIARY_ID,
		POL_NM.CERT_NO,POL_NM.OPEN_POL
		FROM
		PR
		INNER JOIN 
		(
			SELECT * FROM 
			(
				SELECT
				PL.VALID_FROM_DTTM,PL.TRANS_NO,PL.VALID_TO_DTTM,PL.LAST_MODIFIED_BY,PL.LAST_MODIFIED_DTTM,PL.ETL_BATCH_ID,PL.SOURCE_SYSTEM_CD,
				PL.ENTITY_CD,PL.COMPANY_CD,PL.POLICY_NO,PL.PROD_RK,PL.APPL_NO,PL.POLICY_RK,PL.PRODUCING_AGNT_1_RK,PL.PRODUCING_AGNT_2_RK,PL.SERVICING_AGNT_1_RK,
				PL.SERVICING_AGNT_2_RK,PL.ISSUING_BRANCH_1_RK,PL.ISSUING_BRANCH_2_RK,PL.VERSION_NO,PL.ISSUE_TYPE_CD,PL.LOB_CD,PL.STD_LOB_CD,PL.PREVIOUS_POLICY_NO,
				PL.SOURCE_CHNL_CD,PL.STD_SOURCE_CHNL_CD,PL.ORIGINAL_INCEPTION_DT,PL.POLICY_ISSUE_DT,PL.POLICY_EFF_DT,PL.POLICY_EXPIRATION_DT,PL.POLICY_TERMINATION_DT,PL.POLICY_RNWL_DT,
				PL.POLICY_STAT_CD,PL.PAID_TO_DT,PL.PAYMENT_MODE_CD,PL.REFERERER_ID,PL.JACKET_CD,PL.POLICY_CURRENCY_CD,PL.STD_CURRENCY_CD,PL.HEALTH_COV_FLG,PL.GRP_POLICY_FLG,
				PL.GROSS_PREM_AMT,PL.NET_PREM_AMT,PL.LAST_PAYMENT_DT,PL.LF_SUM_INSURED_AMT,PL.LF_MOD_PREM_AMT,
				PL.APPL_SERIAL_NO,
				ROW_NUMBER() OVER ( PARTITION BY PL.POLICY_RK ORDER BY PL.VALID_FROM_DTTM DESC,PL.TRANS_NO DESC ) AS VALID_REC
				FROM POLICY PL
				INNER JOIN PR ON PR.POLICY_RK=PL.POLICY_RK
				WHERE TO_DATE('%toDate%','YYYY-MM-DD') >= PL.VALID_FROM_DTTM  /*VALUE FOR VALID  FROM DATE FIELD*/ AND  TO_DATE('%toDate%','YYYY-MM-DD') <= PL.VALID_TO_DTTM  /*VALUE FOR VALID TO DATE FIELD*/)WHERE VALID_REC=1 
		) POL_COV ON PR.POLICY_RK=POL_COV.POLICY_RK
		
		--New section starts for insured info
		/*LEFT OUTER JOIN
		(
			SELECT
			P.LAST_NM,
			P.PARTY_ID,
			PRP.POLICY_RK
			FROM
			PARTY P
			INNER JOIN
			PARTY_ROLE_POLICY PRP
			ON P.PARTY_RK=PRP.PARTY_RK AND PRP.PARTY_ROLE_CD ='INS'			
		) INS_INFO
		ON POL_COV.POLICY_RK = INS_INFO.POLICY_RK */
		--New section ends for insured info

		LEFT OUTER JOIN 
        (
	    	SELECT POLICY_RK,CERT_NO,OPEN_POL FROM 
	    	(
	    	SELECT 
	    	POLICY_RK,
	    	VALID_FROM_DTTM,
	    	VALID_TO_DTTM,
	    	POL_ITEM_NM,
	    	POL_ITEM_VAL
	    	FROM 
	    		(
	    		SELECT PT.*,
	    		ROW_NUMBER() OVER ( PARTITION BY PT.POLICY_ITEM_RK ORDER BY PT.VALID_FROM_DTTM DESC,PT.TRANS_NO DESC ) AS VALID_REC
	    		FROM POLICY_ITEM PT
	    		INNER JOIN PR ON PT.POLICY_RK=PR.POLICY_RK
	    		WHERE PT.COVERAGE_CD = '0'
	    		AND POL_ITEM_NM != 'CEDANT_POL'
	    		AND TO_DATE('%toDate%','YYYY-MM-DD') >= PT.VALID_FROM_DTTM  /*VALUE OF VALID FROM DATE*/
	    		AND TO_DATE('%toDate%','YYYY-MM-DD') <= PT.VALID_TO_DTTM  /*VALUE OF VALID TO DATE */
	    		ORDER BY COVERAGE_CD
	    		)
	    		WHERE VALID_REC=1
	    	)
	    	PIVOT
	    	(
	    	MAX(POL_ITEM_VAL) FOR POL_ITEM_NM IN ('CERT_NO' AS "CERT_NO",'OPEN_POL' AS "OPEN_POL")
	    	)
	    )POL_NM ON POL_NM.POLICY_RK=POL_COV.POLICY_RK
		
		LEFT OUTER JOIN AGENT AG ON POL_COV.SERVICING_AGNT_1_RK=AG.AGNT_RK
		LEFT OUTER JOIN PRODUCT PDT ON PDT.PROD_RK=POL_COV.PROD_RK
		)TBL WHERE ROWNUM <= 200)
WHERE RNUM >= 1 ORDER BY POLICY_NUMBER DESC